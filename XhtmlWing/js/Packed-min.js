function Vector2(a,b){this.X=a||0;this.Y=b||0}
Vector2.prototype={Add:function(a){this.X+=a.X;this.Y+=a.Y},GetAddition:function(a){return new Vector2(this.X+a.X,this.Y+a.Y)},Subtract:function(a){this.X-=a.X;this.Y-=a.Y},GetSubtraction:function(a){return new Vector2(this.X-a.X,this.Y-a.Y)},Scale:function(a){this.X*=a;this.Y*=a},GetScaled:function(a){return new Vector2(this.X*a,this.Y*a)},GetLength:function(){return Math.sqrt(this.X*this.X+this.Y*this.Y)},GetLengthSq:function(){return this.X*this.X+this.Y*this.Y},Normalize:function(){var a=this.GetLength();
0!=a&&(this.X/=a,this.Y/=a)},GetNormalized:function(){var a=this.GetLength();return 0==a?null:new Vector2(this.X/a,this.Y/a)},Floor:function(){this.X=Math.floor(this.X);this.Y=Math.floor(this.Y)},GetFloor:function(){var a=this.Clone();a.Floor();return a},toString:function(){return"Vector2("+this.X+","+this.Y+")"},Clone:function(){return new Vector2(this.X,this.Y)},IsZero:function(){return 0==this.X&&0==this.Y},ToAngle:function(){var a=Math.acos(this.X/this.GetLength());0>this.Y&&(a=2*Math.PI-a);return a},
Dot:function(a){return this.X*a.X+this.Y*a.Y},GetProjectionScalar:function(a){return this.Dot(a)/a.GetLengthSq()},ReflectAcross:function(a){var b=this.Dot(a),a=a.Clone();a.Scale(2*b);a.Subtract(this);this.X=a.X;this.Y=a.Y},GetReflection:function(a){var b=this.Clone();b.ReflectAcross(a);return b},Rotate:function(a){var b=this.X*Math.cos(a)-this.Y*Math.sin(a);this.Y=this.Y*Math.cos(a)+this.X*Math.sin(a);this.X=b},GetRotated:function(a){var b=this.Clone();b.Rotate(a);return b}};
Vector2.FromSimpleString=function(a){0==a.indexOf("Vector2(")&&(a=a.substr(0,8));a=a.split(",");return new Vector2(parseFloat(a[0]),parseFloat(a[1]))};var Util={RemoveAllChildren:function(a){for(;0<a.childNodes.length;)a.removeChild(a.firstChild)},GetQueryStringParameter:function(a){for(var b=window.location.search.substring(1).split("&"),c=!1,l=0;l<b.length;++l)b[l].substring(0,b[l].indexOf("="))==a&&(c=b[l].substring(b[l].indexOf("=")+1));return c},GetRandomOrthVector:function(a){var b=new THREE.Vector3(a.y-a.z,a.z-a.x,a.x-a.y);if(0===b.lengthSq()){var c=new THREE.Vector3(1,2,3);b.crossVectors(a,c);var l=b.dot(a);if(1E-4<Math.abs(l)||b.isZero())if(c.set(-a.x,
-a.y,a.z),b.crossVectors(a,c),l=a.dot(b),1E-4<Math.abs(l)||b.isZero())c.set(a.X,a.Y,-a.Z),b.crossVectors(a,c)}return b},ReflectAcross:function(a,b){var c=a.clone();c.multiplyScalar(2*b.dot(a));c.subVectors(b,c);return c},MakeOrientationMatrix:function(a,b,c){c||(c=new THREE.Vector3,c.crossVectors(b,a),c.normalize());var l=new THREE.Matrix4;l.elements[0]=c.x;l.elements[1]=c.y;l.elements[2]=c.z;l.elements[4]=a.x;l.elements[5]=a.y;l.elements[6]=a.z;l.elements[8]=b.x;l.elements[9]=b.y;l.elements[10]=
b.z;return l},GetRandomPointInSphere:function(a){var b=new THREE.Vector3(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1);b.normalize();b.multiplyScalar(Math.random()*a);return b},GetRayIntSphereTime:function(a,b,c){var l=new THREE.Vector3;l.subVectors(a.origin,b);b=a.direction.dot(a.direction);a=2*l.dot(a.direction);c=l.dot(l)-c*c;c=a*a-4*b*c;return 0>=c?null:(-a-Math.sqrt(c))/(2*b)},ProjectVectorOntoPlane:function(a,b){var c=a.dot(b)/b.lengthSq();a.sub(b.clone().multiplyScalar(c))}};var PageInput={IsTouchEnabled:!1,_pageObject:null,MousePos:null,Init:function(a){PageInput._pageObject=a;PageInput.IsTouchEnabled="ontouchstart"in window?1:0;PageInput._pageObject.OnKeyDown&&document.addEventListener("keydown",PageInput.OnKeyDown,!1);PageInput._pageObject.OnKeyUp&&document.addEventListener("keyup",PageInput.OnKeyUp,!1);PageInput._pageObject.OnMouseWheel&&document.addEventListener("mousewheel",PageInput.OnMouseWheel,!1);PageInput.IsTouchEnabled&&(document.addEventListener("touchmove",
PageInput.OnTouchMove,!1),PageInput._pageObject.OnTouchStart&&document.addEventListener("touchstart",PageInput.OnTouchStart,!1),PageInput._pageObject.OnTouchEnd&&document.addEventListener("touchend",PageInput.OnTouchEnd,!1));document.addEventListener("mousemove",PageInput.OnMouseMove,!1);PageInput._pageObject.OnTouchStart&&document.addEventListener("mousedown",PageInput.OnMouseDown,!1);PageInput._pageObject.OnTouchEnd&&document.addEventListener("mouseup",PageInput.OnMouseUp,!1)},GetMousePos:function(a){var b=
0,c=0;a||(a=window.event);if(a.pageX||a.pageY)b=a.pageX,c=a.pageY;else if(a.clientX||a.clientY)b=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,c=a.clientY+document.body.scrollTop+document.documentElement.scrollTop;return new Vector2(b,c)},OnMouseMove:function(a){PageInput.MousePos=PageInput.GetMousePos(a);PageInput._pageObject.OnTouchMove&&PageInput._pageObject.OnTouchMove([PageInput.MousePos])},OnMouseDown:function(a){PageInput._pageObject.OnTouchStart&&PageInput._pageObject.OnTouchStart([PageInput.GetMousePos(a)],
1==a.which)},OnMouseUp:function(a){PageInput._pageObject.OnTouchEnd(1==a.which)},OnTouchStart:function(a){if(1==a.touches.length){for(var b=[new Vector2(a.touches[0].pageX,a.touches[0].pageY)],c=1;c<a.touches.length;++c)b.push(new Vector2(a.touches[c].pageX,a.touches[c].pageY));PageInput._pageObject.OnTouchStart&&PageInput._pageObject.OnTouchStart(b,null)}},OnKeyUp:function(a){PageInput._pageObject.OnKeyUp(a.keyCode);9===a.keyCode&&a.preventDefault()},OnKeyDown:function(a){PageInput._pageObject.OnKeyDown(a.keyCode);
9===a.keyCode&&a.preventDefault()},OnMouseWheel:function(a){PageInput._pageObject.OnMouseWheel(a.wheelDelta)},OnTouchMove:function(a){a.preventDefault();PageInput.MousePos=new Vector2(a.touches[0].pageX,a.touches[0].pageY);for(var b=[PageInput.MousePos],c=1;c<a.touches.length;++c)b.push(new Vector2(a.touches[c].pageX,a.touches[c].pageY));PageInput._pageObject.OnTouchMove(b)},OnTouchEnd:function(){PageInput._pageObject.OnTouchEnd(null)}};function Joypad(){this.NormDirection=new Vector2(0,0);this.CurTouchPos=new Vector2(0,0);this.Radius=150;this.PosRadius=50;this.CenterPos=new Vector2(0,0);this._joypadPosElem=this._joypadElem=null;this.ForceToExtreme=!1}Joypad.ElementId="Joypad_23kl4j23k";Joypad.PosElementId="Joypad_Pos_23kl4j23k";
Joypad.prototype={Init:function(){this.CenterPos=new Vector2(this.Radius,window.innerHeight-this.Radius);this.Center()},HandleTouchInput:function(a){a.GetSubtraction(this.CenterPos).GetLengthSq()>this.Radius*this.Radius||(this.CurTouchPos=a.GetSubtraction(this.CenterPos),this.NormDirection=this.CurTouchPos.IsZero()?new Vector2(0,0):this.ForceToExtreme?this.CurTouchPos.GetNormalized():this.CurTouchPos.GetScaled(1/this.Radius),this.Set(this.NormDirection.X,this.NormDirection.Y))},UpdateJoypadPos:function(){this.Set_V2(this.NormDirection)},
Set_V2:function(a){this.Set(a.X,a.Y)},Set:function(a,b){this.NormDirection=new Vector2(a,b);var c=this.NormDirection.GetScaled(this.Radius-this.PosRadius);this._joypadElem&&(this._joypadPosElem.style.left=c.X+this.Radius-this.PosRadius+"px",this._joypadPosElem.style.top=c.Y+this.Radius-this.PosRadius+"px")},Center:function(){this.CurTouchPos=new Vector2(0,0);this.NormDirection=new Vector2(0,0);this._joypadElem&&(this._joypadPosElem.style.left=this.Radius-this.PosRadius+"px",this._joypadPosElem.style.top=
this.Radius-this.PosRadius+"px")},ContainsClientPoint:function(a){return a.GetSubtraction(this.CenterPos).GetLengthSq()<this.Radius*this.Radius}};function Portal(a,b,c,l){this.mesh=null;this.isActive=!1;this.remaingingTime=2;this.hoopList=null;if(null===Portal.Geometry){this.temp_pos=a;this.temp_forward=b;var e=this;(new THREE.JSONLoader).load("models/Portal.js",function(u,r){Portal.Geometry=u;Portal.Material=new THREE.MeshBasicMaterial({map:r[0].map});e.init(a,b,c,l)},{normalizeRGB:!0})}else this.init(a,b,c,l)}Portal.Geometry=null;Portal.Material=null;Portal.GrowTime=0.625;Portal.TimeAlive=10;Portal.FullScale=4.25;Portal.EntryHoopLength=200;
var loader=new THREE.JSONLoader;loader.load("models/Portal.js",function(a,b){Portal.Geometry=a;Portal.Material=new THREE.MeshBasicMaterial({map:b[0].map})});
Portal.prototype={init:function(a,b,c,l){this.isActive=!0;this.remaingingTime=Portal.TimeAlive;this.mesh=new THREE.Mesh(Portal.Geometry,Portal.Material);c=c.clone().multiplyScalar(Portal.EntryHoopLength);this.mesh.position=a.clone().add(c);this.mesh.rotation=b.clone();this.mesh.scale.set(1,1,1);XhtmlWingGame.MainGame._scene.add(this.mesh);this.hoopList=new HoopList;this.hoopList.initAlongRay(a,c,3,function(){XhtmlWingGame.MainGame.goToNewArea(l)});XhtmlWingGame.MainGame._hoopLists.push(this.hoopList)},
update:function(a){var b=Portal.GrowTime-(Portal.TimeAlive-this.remaingingTime);this.remaingingTime-=a;var c=Portal.GrowTime-(Portal.TimeAlive-this.remaingingTime);0<b&&(b=Portal.FullScale,0<c&&(b=(Portal.GrowTime-c)/Portal.GrowTime*Portal.FullScale),this.mesh.scale.set(b,b,b));0>this.remaingingTime&&(this.isActive=!1,XhtmlWingGame.MainGame._scene.remove(this.mesh),c=$.inArray(this.hoopList,XhtmlWingGame.MainGame._hoopLists),0<=c&&XhtmlWingGame.MainGame._hoopLists.splice(c,1),this.hoopList.remove());
this.mesh.rotation.z+=1*a}};function Laser(a){this.Direction=a.Forward.clone();this.Direction.multiplyScalar(Laser.LASER_SPEED);this.Mesh=new THREE.Mesh(Laser.CYLINDER,a.IsGoodGuy?Laser.MATERIAL_RED:Laser.MATERIAL_GREEN);this.Mesh.position=a.Position.clone();this.Mesh.rotation=a.Mesh?a.Mesh.rotation:a.GetOrientationEuler();var b=a.Weapons[a.NextWeaponToUse].MuzzleOffset.clone();a.NextWeaponToUse=(a.NextWeaponToUse+1)%a.Weapons.length;var c=a.Position.clone();c.add(a.Right.clone().multiplyScalar(b.x));c.add(a.Up.clone().multiplyScalar(b.y));
c.add(a.Forward.clone().multiplyScalar(b.z));this.Mesh.position=c;this.Damage=20;XhtmlWingGame.MainGame._scene.add(this.Mesh);this.OwningShip=a;this.RemainingLife=3}Laser.CYLINDER=null;Laser.MATERIAL_GREEN=null;Laser.MATERIAL_RED=null;Laser.CYLINDER=new THREE.CylinderGeometry(0.5,0.5,50,7,1,!1);Laser.CYLINDER.applyMatrix((new THREE.Matrix4).makeRotationX(Math.PI/2));Laser.MATERIAL_GREEN=new THREE.MeshBasicMaterial({color:2293555,wireframe:!1});
Laser.MATERIAL_RED=new THREE.MeshBasicMaterial({color:16720435,wireframe:!1});Laser.LASER_SPEED=1250;function BuildManager(a){this.cells=null;this.moveVector=new THREE.Vector2;this.centerPos=a;this.orbitRadius=BuildManager.InitialBuildRadius;this.zoomAmount=0;this.MoveSpeed=200;this.boxes=[];this.hilite_blockMesh=null}BuildManager.InitialBuildRadius=200;BuildManager.BlockSize=25;BuildManager.BlockGeometry=new THREE.CubeGeometry(BuildManager.BlockSize,BuildManager.BlockSize,BuildManager.BlockSize);
BuildManager.BlockHalfExtent=new THREE.Vector3(BuildManager.BlockSize/2,BuildManager.BlockSize/2,BuildManager.BlockSize/2);BuildManager.MetalBoxTexture=THREE.ImageUtils.loadTexture("img/structure-cube-face.jpg");
BuildManager.prototype={update:function(a){if(0<this.moveVector.lengthSq()||0!=this.zoomAmount){var b=XhtmlWingGame.MainGame._playerShip,c=b.Right.clone().multiplyScalar(this.moveVector.x*this.MoveSpeed*a);c.add(b.Up.clone().multiplyScalar(this.moveVector.y*this.MoveSpeed*a));a=b.Position.clone().add(c);a.sub(this.centerPos);a.normalize();b.Forward=a.clone().negate();this.orbitRadius+=this.zoomAmount;this.zoomAmount=0;a.multiplyScalar(this.orbitRadius);a.add(this.centerPos);b.Position=a;b.Up.crossVectors(b.Right,
b.Forward);b.Up.normalize();b.Right.crossVectors(b.Forward,b.Up);b.Right.normalize()}b=this.getMouseRay(PageInput.MousePos);b=this.getIntersectBoxInfo(b);null!==b?(null===this.hilite_blockMesh&&(this.hilite_material=new THREE.MeshBasicMaterial({color:65280,ambient:65280,emissive:65280,transparent:!0,opacity:0.125,wireframe:!1}),this.hilite_blockMesh=new THREE.Mesh(BuildManager.BlockGeometry,this.hilite_material),XhtmlWingGame.MainGame._scene.add(this.hilite_blockMesh)),b=this.getNeighborBox(b.intBox,
b.intPos),this.hilite_blockMesh.position=b.center(),this.hilite_blockMesh.visible=!0):null!==this.hilite_blockMesh&&(this.hilite_blockMesh.visible=!1)},term:function(){null!==this.hilite_blockMesh&&XhtmlWingGame.MainGame._scene.remove(this.hilite_blockMesh)},getIntersectBoxInfo:function(a){for(var b=Number.MAX_VALUE,c=null,l=-1,e=0;e<this.boxes.length;++e){var u=this.boxes[e],r=a.intersectBox(u);if(null!=r){var n=r.clone().sub(a.origin).lengthSq();n<b&&(b=n,c=u,l=r)}}return null===c?null:{intBox:c,
intPos:l}},getNeighborBox:function(a,b){a.center();var c=(new THREE.Vector3).subVectors(b,a.center());Math.abs(c.x)>Math.abs(c.y)&&Math.abs(c.x)>Math.abs(c.z)?0>c.x?c.set(-1,0,0):c.set(1,0,0):Math.abs(c.y)>Math.abs(c.x)&&Math.abs(c.y)>Math.abs(c.z)?0>c.y?c.set(0,-1,0):c.set(0,1,0):Math.abs(c.z)>Math.abs(c.x)&&Math.abs(c.z)>Math.abs(c.y)&&(0>c.z?c.set(0,0,-1):c.set(0,0,1));var l=a.min.clone(),e=a.max.clone(),c=c.clone().multiplyScalar(BuildManager.BlockSize);l.add(c);e.add(c);return new THREE.Box3(l,
e)},getMouseRay:function(a){var b=new THREE.Vector2;b.x=2*(a.X/window.innerWidth)-1;b.y=2*-(a.Y/window.innerHeight)+1;a=new THREE.Projector;b=new THREE.Vector3(b.x,b.y,1);b=a.unprojectVector(b,XhtmlWingGame.MainGame._camera);b.sub(XhtmlWingGame.MainGame._camera.position);b.normalize();return new THREE.Ray(XhtmlWingGame.MainGame._camera.position,b)},removeBox:function(a){XhtmlWingGame.MainGame._scene.remove(a.mesh);a=$.inArray(a,this.boxes);0<=a&&this.boxes.splice(a,1)},onMouseDown:function(a,b){var c=
this.getMouseRay(a),l=this.getIntersectBoxInfo(c);if(!(null===l&&0<this.boxes.length))if(!1===b)this.removeBox(l.intBox);else{var c=new THREE.MeshBasicMaterial({color:11184810,ambient:11184810,map:BuildManager.MetalBoxTexture,wireframe:!1}),c=new THREE.Mesh(BuildManager.BlockGeometry,c),e=null;null!==l?e=this.getNeighborBox(l.intBox,l.intPos):(l=this.centerPos.clone().add(BuildManager.BlockHalfExtent.clone().negate()),e=this.centerPos.clone().add(BuildManager.BlockHalfExtent),e=new THREE.Box3(l,e));
this.boxes.push(e);e.mesh=c;c.position=e.center();XhtmlWingGame.MainGame._scene.add(c)}},onKeyDown:function(a){switch(a){case 27:XhtmlWingGame.MainGame.setBuildMode(!1);break;case 87:this.moveVector.y=1;break;case 65:this.moveVector.x=-1;break;case 83:this.moveVector.y=-1;break;case 68:this.moveVector.x=1}},onKeyUp:function(a){switch(a){case 87:case 83:this.moveVector.y=0;break;case 65:case 68:this.moveVector.x=0}},onMouseWheel:function(a){this.zoomAmount=50*(0>a?1:-1)}};function Asteroid(a,b,c){this.mesh=a;this.rotationSpeed=b||new THREE.Vector3(1,0,0);this.modelIndex=c||0}function AsteroidField(a){this._areaDescriptor=a;this._asteroids=[];this._modelPath="models/Asteroids/"}function RangeRandom(a){return(2*Math.random()-1)*a}
AsteroidField.prototype={init:function(a,b){this.generate(a,0,b)},update:function(a){for(var b=this._asteroids.length-1;0<b--;){var c=this._asteroids[b];c.mesh.rotation.x+=c.rotationSpeed.x*a;c.mesh.rotation.y+=c.rotationSpeed.y*a;c.mesh.rotation.z+=c.rotationSpeed.z*a}},generate:function(a){for(var b=0;1500>b;++b){var c=new THREE.Vector3(RangeRandom(2500),RangeRandom(2500),RangeRandom(2500)),l=new THREE.Vector3(RangeRandom(1),RangeRandom(1),RangeRandom(1)),e=Math.floor(Math.random()*this._areaDescriptor.asteroidModels.length),
e=this._areaDescriptor.asteroidModels[e],e=new THREE.Mesh(e.geometry,e.material);e.position=c;c=20*(0.5+Math.random());e.scale=new THREE.Vector3(c,c,c);l=new Asteroid(e,l);this._asteroids.push(l);a.add(e)}}};function AreaDescriptor(){this.asteroidModelFiles=[];this.asteroidModels=[];this.asteroidFields=[];this.skyboxImage_Prefix="space_skybox/moreblue/space_skybox_";this.skyboxImage_Extension=".jpg"}
AreaDescriptor.prototype={load:function(a){if(null===this.asteroidModelFiles||0===this.asteroidModelFiles.length)a();else for(var b=new THREE.JSONLoader,c=this,l=0,e=function(b,e){c.asteroidModels.push({geometry:b,material:e[0]});++l;l>=c.asteroidModelFiles.length&&a()},u=0;u<this.asteroidModelFiles.length;++u)b.load(this.asteroidModelFiles[u],e)}};AreaDescriptor.Area1=new AreaDescriptor;AreaDescriptor.Area1.skyboxImage_Prefix="space_skybox/moreblue/space_skybox_";
AreaDescriptor.Area1.skyboxImage_Extension=".jpg";AreaDescriptor.Area2=new AreaDescriptor;AreaDescriptor.Area2.skyboxImage_Prefix="space_skybox/green/green_";AreaDescriptor.Area2.skyboxImage_Extension=".jpg";AreaDescriptor.Area3=new AreaDescriptor;var asteroidPath="models/Asteroids/red/asteroid";AreaDescriptor.Area3.asteroidModelFiles=[asteroidPath+"1.js",asteroidPath+"2.js",asteroidPath+"3.js",asteroidPath+"4.js",asteroidPath+"5.js",asteroidPath+"6.js",asteroidPath+"7.js"];AreaDescriptor.Area3.asteroidFields.push(new AsteroidField(AreaDescriptor.Area3));
AreaDescriptor.Area3.skyboxImage_Prefix="space_skybox/orange/orange_";AreaDescriptor.Area3.skyboxImage_Extension=".jpg";AreaDescriptor.Areas=[AreaDescriptor.Area1,AreaDescriptor.Area2,AreaDescriptor.Area3];(function(){function a(g){return function(z,a,s,h){var d={back:g};e.is(s,"function")?h=s:d.rot=s;z&&z.constructor==E&&(z=z.attrs.path);z&&(d.along=z);return this.animate(d,a,h)}}function b(){return this.x+I+this.y}function c(g,z,a){function s(){var h=Array[m].slice.call(arguments,0),d=h[L]("\u25ba"),b=s.cache=s.cache||{},c=s.count=s.count||[];if(b[p](d))return a?a(b[d]):b[d];1E3<=c[t]&&delete b[c.shift()];c[F](d);b[d]=g[H](z,h);return a?a(b[d]):b[d]}return s}function l(){for(var g=[],z=0;32>z;z++)g[z]=
(~~(16*B.random()))[X](16);g[12]=4;g[16]=(g[16]&3|8)[X](16);return"r-"+g[L]("")}function e(){if(e.is(arguments[0],R)){for(var g=arguments[0],z=ua[H](e,g.splice(0,3+e.is(g[0],M))),a=z.set(),s=0,b=g[t];s<b;s++){var d=g[s]||{};r[p](d.type)&&a[F](z[d.type]().attr(d))}return a}return ua[H](e,arguments)}e.version="1.5.2";var u=/[, ]+/,r={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},n=/\{(\d+)\}/g,m="prototype",p="hasOwnProperty",q=document,D=window,Ja=Object[m][p].call(D,"Raphael"),lb=D.Raphael,ca=
function(){this.customAttributes={}},y,H="apply",aa="createTouch"in q,I=" ",C=String,Ka="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend orientationchange touchcancel gesturestart gesturechange gestureend".split(I),va={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},L="join",t="length",ba=C[m].toLowerCase,B=Math,Q=B.max,W=B.min,J=B.abs,G=B.pow,P=B.PI,M="number",R="array",X="toString",mb=Object[m][X],F="push",La=/^url\(['"]?([^\)]+?)['"]?\)$/i,
nb=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i,ob={NaN:1,Infinity:1,"-Infinity":1},pb=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,N=B.round,x=parseFloat,Y=parseInt,ja=C[m].toUpperCase,ka={blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",
cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/",opacity:1,path:"M0,0",r:0,rotation:0,rx:0,ry:0,scale:"1 1",src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",translation:"0 0",width:0,x:0,y:0},wa={along:"along",
blur:M,"clip-rect":"csv",cx:M,cy:M,fill:"colour","fill-opacity":M,"font-size":M,height:M,opacity:M,path:"path",r:M,rotation:"csv",rx:M,ry:M,scale:"csv",stroke:"colour","stroke-opacity":M,"stroke-width":M,translation:"csv",width:M,x:M,y:M},qb=/^(from|to|\d+%?)$/,xa=/\s*,\s*/,rb={hs:1,rg:1},sb=/,?([achlmqrstvxz]),?/gi,tb=/([achlmqstvz])[\s,]*((-?\d*\.?\d*(?:e[-+]?\d+)?\s*,?\s*)+)/ig,ub=/(-?\d*\.?\d*(?:e[-+]?\d+)?)\s*,?\s*/ig,Ma=/^r(?:\(([^,]+?)\s*,\s*([^\)]+?)\))?/,vb=function(g,z){return g.key-z.key};
e.type=D.SVGAngle||q.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML";if("VML"==e.type){var ya=q.createElement("div"),la;ya.innerHTML='<v:shape adj="1"/>';la=ya.firstChild;la.style.behavior="url(#default#VML)";if(!la||"object"!=typeof la.adj)return e.type=null;ya=null}e.svg=!(e.vml="VML"==e.type);ca[m]=e[m];y=ca[m];e._id=0;e._oid=0;e.fn={};e.is=function(g,z){z=ba.call(z);return"finite"==z?!ob[p](+g):"null"==z&&null===g||z==typeof g||"object"==z&&g===
Object(g)||"array"==z&&Array.isArray&&Array.isArray(g)||mb.call(g).slice(8,-1).toLowerCase()==z};e.angle=function(g,z,a,s,b,d){return null==b?(g-=a,z-=s,!g&&!z?0:(180*(0>g)+180*B.atan(-z/-g)/P+360)%360):e.angle(g,z,b,d)-e.angle(a,s,b,d)};e.rad=function(g){return g%360*P/180};e.deg=function(g){return 180*g/P%360};e.snapTo=function(g,z,a){a=e.is(a,"finite")?a:10;if(e.is(g,R))for(var s=g.length;s--;){if(J(g[s]-z)<=a)return g[s]}else{g=+g;s=z%g;if(s<a)return z-s;if(s>g-a)return z-s+g}return z};e.setWindow=
function(g){D=g;q=D.document};var ma=function(g){if(e.vml){var a=/^\s+|\s+$/g,f;try{var s=new ActiveXObject("htmlfile");s.write("<body>");s.close();f=s.body}catch(b){f=createPopup().document.body}var d=f.createTextRange();ma=c(function(g){try{f.style.color=C(g).replace(a,"");var s=d.queryCommandValue("ForeColor");return"#"+("000000"+((s&255)<<16|s&65280|(s&16711680)>>>16)[X](16)).slice(-6)}catch(b){return"none"}})}else{var i=q.createElement("i");i.title="Rapha\u00ebl Colour Picker";i.style.display=
"none";q.body.appendChild(i);ma=c(function(g){i.style.color=g;return q.defaultView.getComputedStyle(i,"").getPropertyValue("color")})}return ma(g)},Na=function(){return"hsb("+[this.h,this.s,this.b]+")"},wb=function(){return"hsl("+[this.h,this.s,this.l]+")"},xb=function(){return this.hex};e.hsb2rgb=function(g,a,f,s){e.is(g,"object")&&"h"in g&&"s"in g&&"b"in g&&(f=g.b,a=g.s,g=g.h,s=g.o);return e.hsl2rgb(g,a,f/2,s)};e.hsl2rgb=function(g,a,f,s){e.is(g,"object")&&"h"in g&&"s"in g&&"l"in g&&(f=g.l,a=g.s,
g=g.h);if(1<g||1<a||1<f)g/=360,a/=100,f/=100;var b={},d=["r","g","b"],i;if(a){0.5>f?i=f*(1+a):i=f+a-f*a;for(var a=2*f-i,c=0;3>c;c++)f=g+1/3*-(c-1),0>f&&f++,1<f&&f--,1>6*f?b[d[c]]=a+6*(i-a)*f:1>2*f?b[d[c]]=i:2>3*f?b[d[c]]=a+6*(i-a)*(2/3-f):b[d[c]]=a}else b={r:f,g:f,b:f};b.r*=255;b.g*=255;b.b*=255;b.hex="#"+(16777216|b.b|b.g<<8|b.r<<16).toString(16).slice(1);e.is(s,"finite")&&(b.opacity=s);b.toString=xb;return b};e.rgb2hsb=function(g,a,f){null==a&&e.is(g,"object")&&"r"in g&&"g"in g&&"b"in g&&(f=g.b,
a=g.g,g=g.r);null==a&&e.is(g,"string")&&(f=e.getRGB(g),g=f.r,a=f.g,f=f.b);if(1<g||1<a||1<f)g/=255,a/=255,f/=255;var s=Q(g,a,f),b=W(g,a,f),d;if(b==s)return{h:0,s:0,b:s,toString:Na};b=s-b;g==s?d=(a-f)/b:a==s?d=2+(f-g)/b:d=4+(g-a)/b;d/=6;0>d&&d++;1<d&&d--;return{h:d,s:b/s,b:s,toString:Na}};e.rgb2hsl=function(g,a,f){null==a&&e.is(g,"object")&&"r"in g&&"g"in g&&"b"in g&&(f=g.b,a=g.g,g=g.r);null==a&&e.is(g,"string")&&(f=e.getRGB(g),g=f.r,a=f.g,f=f.b);if(1<g||1<a||1<f)g/=255,a/=255,f/=255;var s=Q(g,a,f),
b=W(g,a,f),d,i=(s+b)/2;if(b==s)g={h:0,s:0,l:i};else{var c=s-b;g==s?d=(a-f)/c:a==s?d=2+(f-g)/c:d=4+(g-a)/c;d/=6;0>d&&d++;1<d&&d--;g={h:d,s:0.5>i?c/(s+b):c/(2-s-b),l:i}}g.toString=wb;return g};e._path2string=function(){return this.join(",").replace(sb,"$1")};e.getRGB=c(function(g){if(!g||(g=C(g)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1};if("none"==g)return{r:-1,g:-1,b:-1,hex:"none"};!rb[p](g.toLowerCase().substring(0,2))&&"#"!=g.charAt()&&(g=ma(g));var a,f,s,b,d,i;if(g=g.match(nb)){g[2]&&
(s=Y(g[2].substring(5),16),f=Y(g[2].substring(3,5),16),a=Y(g[2].substring(1,3),16));g[3]&&(s=Y((d=g[3].charAt(3))+d,16),f=Y((d=g[3].charAt(2))+d,16),a=Y((d=g[3].charAt(1))+d,16));g[4]&&(i=g[4].split(xa),a=x(i[0]),"%"==i[0].slice(-1)&&(a*=2.55),f=x(i[1]),"%"==i[1].slice(-1)&&(f*=2.55),s=x(i[2]),"%"==i[2].slice(-1)&&(s*=2.55),"rgba"==g[1].toLowerCase().slice(0,4)&&(b=x(i[3])),i[3]&&"%"==i[3].slice(-1)&&(b/=100));if(g[5])return i=g[5].split(xa),a=x(i[0]),"%"==i[0].slice(-1)&&(a*=2.55),f=x(i[1]),"%"==
i[1].slice(-1)&&(f*=2.55),s=x(i[2]),"%"==i[2].slice(-1)&&(s*=2.55),("deg"==i[0].slice(-3)||"\u00b0"==i[0].slice(-1))&&(a/=360),"hsba"==g[1].toLowerCase().slice(0,4)&&(b=x(i[3])),i[3]&&"%"==i[3].slice(-1)&&(b/=100),e.hsb2rgb(a,f,s,b);if(g[6])return i=g[6].split(xa),a=x(i[0]),"%"==i[0].slice(-1)&&(a*=2.55),f=x(i[1]),"%"==i[1].slice(-1)&&(f*=2.55),s=x(i[2]),"%"==i[2].slice(-1)&&(s*=2.55),("deg"==i[0].slice(-3)||"\u00b0"==i[0].slice(-1))&&(a/=360),"hsla"==g[1].toLowerCase().slice(0,4)&&(b=x(i[3])),i[3]&&
"%"==i[3].slice(-1)&&(b/=100),e.hsl2rgb(a,f,s,b);g={r:a,g:f,b:s};g.hex="#"+(16777216|s|f<<8|a<<16).toString(16).slice(1);e.is(b,"finite")&&(g.opacity=b);return g}return{r:-1,g:-1,b:-1,hex:"none",error:1}},e);e.getColor=function(g){var g=this.getColor.start=this.getColor.start||{h:0,s:1,b:g||0.75},a=this.hsb2rgb(g.h,g.s,g.b);g.h+=0.075;1<g.h&&(g.h=0,g.s-=0.2,0>=g.s&&(this.getColor.start={h:0,s:1,b:g.b}));return a.hex};e.getColor.reset=function(){delete this.start};e.parsePathString=c(function(g){if(!g)return null;
var a={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},f=[];e.is(g,R)&&e.is(g[0],R)&&(f=na(g));f[t]||C(g).replace(tb,function(g,b,d){var i=[],g=ba.call(b);d.replace(ub,function(g,a){a&&i[F](+a)});for("m"==g&&2<i[t]&&(f[F]([b].concat(i.splice(0,2))),g="l",b="m"==b?"l":"L");i[t]>=a[g]&&!(f[F]([b].concat(i.splice(0,a[g]))),!a[g]););});f[X]=e._path2string;return f});e.findDotsAtSegment=function(g,a,f,b,h,d,i,c,k){var j=1-k,e=G(j,3)*g+3*G(j,2)*k*f+3*j*k*k*h+G(k,3)*i,j=G(j,3)*a+3*G(j,2)*k*b+3*j*k*k*d+G(k,3)*c,
m=g+2*k*(f-g)+k*k*(h-2*f+g),l=a+2*k*(b-a)+k*k*(d-2*b+a),q=f+2*k*(h-f)+k*k*(i-2*h+f),p=b+2*k*(d-b)+k*k*(c-2*d+b),g=(1-k)*g+k*f,a=(1-k)*a+k*b,h=(1-k)*h+k*i,d=(1-k)*d+k*c,c=90-180*B.atan((m-q)/(l-p))/P;(m>q||l<p)&&(c+=180);return{x:e,y:j,m:{x:m,y:l},n:{x:q,y:p},start:{x:g,y:a},end:{x:h,y:d},alpha:c}};var pa=c(function(g){if(!g)return{x:0,y:0,width:0,height:0};for(var g=oa(g),a=0,f=0,b=[],h=[],d,i=0,c=g[t];i<c;i++)d=g[i],"M"==d[0]?(a=d[1],f=d[2],b[F](a),h[F](f)):(a=yb(a,f,d[1],d[2],d[3],d[4],d[5],d[6]),
b=b.concat(a.min.x,a.max.x),h=h.concat(a.min.y,a.max.y),a=d[5],f=d[6]);g=W[H](0,b);d=W[H](0,h);return{x:g,y:d,width:Q[H](0,b)-g,height:Q[H](0,h)-d}}),na=function(g){var a=[];if(!e.is(g,R)||!e.is(g&&g[0],R))g=e.parsePathString(g);for(var f=0,b=g[t];f<b;f++){a[f]=[];for(var h=0,d=g[f][t];h<d;h++)a[f][h]=g[f][h]}a[X]=e._path2string;return a},za=c(function(g){if(!e.is(g,R)||!e.is(g&&g[0],R))g=e.parsePathString(g);var a=[],f=0,b=0,h=0,d=0,i=0;"M"==g[0][0]&&(f=g[0][1],b=g[0][2],h=f,d=b,i++,a[F](["M",f,
b]));for(var c=g[t];i<c;i++){var k=a[i]=[],j=g[i];if(j[0]!=ba.call(j[0]))switch(k[0]=ba.call(j[0]),k[0]){case "a":k[1]=j[1];k[2]=j[2];k[3]=j[3];k[4]=j[4];k[5]=j[5];k[6]=+(j[6]-f).toFixed(3);k[7]=+(j[7]-b).toFixed(3);break;case "v":k[1]=+(j[1]-b).toFixed(3);break;case "m":h=j[1],d=j[2];default:for(var m=1,l=j[t];m<l;m++)k[m]=+(j[m]-(m%2?f:b)).toFixed(3)}else{a[i]=[];"m"==j[0]&&(h=j[1]+f,d=j[2]+b);k=0;for(m=j[t];k<m;k++)a[i][k]=j[k]}j=a[i][t];switch(a[i][0]){case "z":f=h;b=d;break;case "h":f+=+a[i][j-
1];break;case "v":b+=+a[i][j-1];break;default:f+=+a[i][j-2],b+=+a[i][j-1]}}a[X]=e._path2string;return a},0,na),ea=c(function(g){if(!e.is(g,R)||!e.is(g&&g[0],R))g=e.parsePathString(g);var a=[],f=0,b=0,h=0,d=0,i=0;"M"==g[0][0]&&(f=+g[0][1],b=+g[0][2],h=f,d=b,i++,a[0]=["M",f,b]);for(var c=g[t];i<c;i++){var k=a[i]=[],j=g[i];if(j[0]!=ja.call(j[0]))switch(k[0]=ja.call(j[0]),k[0]){case "A":k[1]=j[1];k[2]=j[2];k[3]=j[3];k[4]=j[4];k[5]=j[5];k[6]=+(j[6]+f);k[7]=+(j[7]+b);break;case "V":k[1]=+j[1]+b;break;case "H":k[1]=
+j[1]+f;break;case "M":h=+j[1]+f,d=+j[2]+b;default:for(var m=1,l=j[t];m<l;m++)k[m]=+j[m]+(m%2?f:b)}else{m=0;for(l=j[t];m<l;m++)a[i][m]=j[m]}switch(k[0]){case "Z":f=h;b=d;break;case "H":f=k[1];break;case "V":b=k[1];break;case "M":h=a[i][a[i][t]-2],d=a[i][a[i][t]-1];default:f=a[i][a[i][t]-2],b=a[i][a[i][t]-1]}}a[X]=e._path2string;return a},null,na),Oa=function(g,a,f,b,h,d){var i=1/3,c=2/3;return[i*g+c*f,i*a+c*b,i*h+c*f,i*d+c*b,h,d]},Pa=function(g,a,f,b,h,d,i,e,k,j){var m=120*P/180,l=P/180*(+h||0),q=
[],p,u=c(function(g,a,f){var z=g*B.cos(f)-a*B.sin(f),g=g*B.sin(f)+a*B.cos(f);return{x:z,y:g}});if(j)n=j[0],p=j[1],d=j[2],O=j[3];else{p=u(g,a,-l);g=p.x;a=p.y;p=u(e,k,-l);e=p.x;k=p.y;B.cos(P/180*h);B.sin(P/180*h);p=(g-e)/2;n=(a-k)/2;O=p*p/(f*f)+n*n/(b*b);1<O&&(O=B.sqrt(O),f*=O,b*=O);var O=f*f,fa=b*b,O=(d==i?-1:1)*B.sqrt(J((O*fa-O*n*n-fa*p*p)/(O*n*n+fa*p*p))),d=O*f*n/b+(g+e)/2,O=O*-b*p/f+(a+k)/2,n=B.asin(((a-O)/b).toFixed(9));p=B.asin(((k-O)/b).toFixed(9));n=g<d?P-n:n;p=e<d?P-p:p;0>n&&(n=2*P+n);0>p&&
(p=2*P+p);i&&n>p&&(n-=2*P);!i&&p>n&&(p-=2*P)}if(J(p-n)>m){var q=p,fa=e,r=k;p=n+m*(i&&p>n?1:-1);e=d+f*B.cos(p);k=O+b*B.sin(p);q=Pa(e,k,f,b,h,0,i,fa,r,[p,q,d,O])}d=p-n;h=B.cos(n);m=B.sin(n);i=B.cos(p);p=B.sin(p);d=B.tan(d/4);f=4/3*f*d;d*=4/3*b;b=[g,a];g=[g+f*m,a-d*h];a=[e+f*p,k-d*i];e=[e,k];g[0]=2*b[0]-g[0];g[1]=2*b[1]-g[1];if(j)return[g,a,e].concat(q);q=[g,a,e].concat(q)[L]().split(",");j=[];e=0;for(k=q[t];e<k;e++)j[e]=e%2?u(q[e-1],q[e],l).y:u(q[e],q[e+1],l).x;return j},qa=function(g,a,f,b,h,d,i,c,
k){var j=1-k;return{x:G(j,3)*g+3*G(j,2)*k*f+3*j*k*k*h+G(k,3)*i,y:G(j,3)*a+3*G(j,2)*k*b+3*j*k*k*d+G(k,3)*c}},yb=c(function(g,a,f,b,h,d,i,c){var k=h-2*f+g-(i-2*h+f),j=2*(f-g)-2*(h-f),e=g-f,m=(-j+B.sqrt(j*j-4*k*e))/2/k,k=(-j-B.sqrt(j*j-4*k*e))/2/k,p=[a,c],l=[g,i],q;"1e12"<J(m)&&(m=0.5);"1e12"<J(k)&&(k=0.5);0<m&&1>m&&(q=qa(g,a,f,b,h,d,i,c,m),l[F](q.x),p[F](q.y));0<k&&1>k&&(q=qa(g,a,f,b,h,d,i,c,k),l[F](q.x),p[F](q.y));k=d-2*b+a-(c-2*d+b);j=2*(b-a)-2*(d-b);e=a-b;m=(-j+B.sqrt(j*j-4*k*e))/2/k;k=(-j-B.sqrt(j*
j-4*k*e))/2/k;"1e12"<J(m)&&(m=0.5);"1e12"<J(k)&&(k=0.5);0<m&&1>m&&(q=qa(g,a,f,b,h,d,i,c,m),l[F](q.x),p[F](q.y));0<k&&1>k&&(q=qa(g,a,f,b,h,d,i,c,k),l[F](q.x),p[F](q.y));return{min:{x:W[H](0,l),y:W[H](0,p)},max:{x:Q[H](0,l),y:Q[H](0,p)}}}),oa=c(function(g,a){var f=ea(g),b=a&&ea(a),h={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},d={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},c=function(g,a){var f,b;if(!g)return["C",a.x,a.y,a.x,a.y,a.x,a.y];!(g[0]in{T:1,Q:1})&&(a.qx=a.qy=null);switch(g[0]){case "M":a.X=
g[1];a.Y=g[2];break;case "A":g=["C"].concat(Pa[H](0,[a.x,a.y].concat(g.slice(1))));break;case "S":f=a.x+(a.x-(a.bx||a.x));b=a.y+(a.y-(a.by||a.y));g=["C",f,b].concat(g.slice(1));break;case "T":a.qx=a.x+(a.x-(a.qx||a.x));a.qy=a.y+(a.y-(a.qy||a.y));g=["C"].concat(Oa(a.x,a.y,a.qx,a.qy,g[1],g[2]));break;case "Q":a.qx=g[1];a.qy=g[2];g=["C"].concat(Oa(a.x,a.y,g[1],g[2],g[3],g[4]));break;case "L":g=["C"].concat([a.x,a.y,g[1],g[2],g[1],g[2]]);break;case "H":g=["C"].concat([a.x,a.y,g[1],a.y,g[1],a.y]);break;
case "V":g=["C"].concat([a.x,a.y,a.x,g[1],a.x,g[1]]);break;case "Z":g=["C"].concat([a.x,a.y,a.X,a.Y,a.X,a.Y])}return g},e=function(g,a){if(7<g[a][t]){g[a].shift();for(var z=g[a];z[t];)g.splice(a++,0,["C"].concat(z.splice(0,6)));g.splice(a,1);m=Q(f[t],b&&b[t]||0)}},k=function(g,a,z,d,h){g&&a&&"M"==g[h][0]&&"M"!=a[h][0]&&(a.splice(h,0,["M",d.x,d.y]),z.bx=0,z.by=0,z.x=g[h][1],z.y=g[h][2],m=Q(f[t],b&&b[t]||0))},j=0,m=Q(f[t],b&&b[t]||0);for(;j<m;j++){f[j]=c(f[j],h);e(f,j);b&&(b[j]=c(b[j],d));b&&e(b,j);
k(f,b,h,d,j);k(b,f,d,h,j);var p=f[j],q=b&&b[j],l=p[t],n=b&&q[t];h.x=p[l-2];h.y=p[l-1];h.bx=x(p[l-4])||h.x;h.by=x(p[l-3])||h.y;d.bx=b&&(x(q[n-4])||d.x);d.by=b&&(x(q[n-3])||d.y);d.x=b&&q[n-2];d.y=b&&q[n-1]}return b?[f,b]:f},null,na),Qa=c(function(g){for(var a=[],f=0,b=g[t];f<b;f++){var h={},d=g[f].match(/^([^:]*):?([\d\.]*)/);h.color=e.getRGB(d[1]);if(h.color.error)return null;h.color=h.color.hex;d[2]&&(h.offset=d[2]+"%");a[F](h)}f=1;for(b=a[t]-1;f<b;f++)if(!a[f].offset){g=x(a[f-1].offset||0);d=0;for(h=
f+1;h<b;h++)if(a[h].offset){d=a[h].offset;break}d||(d=100,h=b);d=x(d);for(d=(d-g)/(h-f+1);f<h;f++)g+=d,a[f].offset=g+"%"}return a}),Ra=function(g,a,b,s){if(!e.is(g,"string")&&!e.is(g,"object"))return{container:1,x:g,y:a,width:b,height:s};g=e.is(g,"string")?q.getElementById(g):g;if(g.tagName)return null==a?{container:g,width:g.style.pixelWidth||g.offsetWidth,height:g.style.pixelHeight||g.offsetHeight}:{container:g,width:a,height:b}},Aa=function(g,a){var b=this,s;for(s in a)if(a[p](s)&&!(s in g))switch(typeof a[s]){case "function":(function(a){g[s]=
g===b?a:function(){return a[H](b,arguments)}})(a[s]);break;case "object":g[s]=g[s]||{};Aa.call(this,g[s],a[s]);break;default:g[s]=a[s]}},da=function(g,a){g==a.top&&(a.top=g.prev);g==a.bottom&&(a.bottom=g.next);g.next&&(g.next.prev=g.prev);g.prev&&(g.prev.next=g.next)},Sa=function(g,a){a.top!==g&&(da(g,a),g.next=null,g.prev=a.top,a.top.next=g,a.top=g)},Ta=function(g,a){a.bottom!==g&&(da(g,a),g.next=a.bottom,g.prev=null,a.bottom.prev=g,a.bottom=g)},Ua=function(g,a,b){da(g,b);a==b.top&&(b.top=g);a.next&&
(a.next.prev=g);g.next=a.next;g.prev=a;a.next=g},Va=function(g,a,b){da(g,b);a==b.bottom&&(b.bottom=g);a.prev&&(a.prev.next=g);g.prev=a.prev;a.prev=g;g.next=a},Wa=function(g){return function(){throw Error("Rapha\u00ebl: you are calling to method \u201c"+g+"\u201d of removed object");}};e.pathToRelative=za;if(e.svg){y.svgns="http://www.w3.org/2000/svg";y.xlink="http://www.w3.org/1999/xlink";var N=function(g){return+g+0.5*(~~g===g)},v=function(g,a){if(!a)return g=q.createElementNS(y.svgns,g),g.style.webkitTapHighlightColor=
"rgba(0,0,0,0)",g;for(var b in a)a[p](b)&&g.setAttribute(b,C(a[b]))};e[X]=function(){return"Your browser supports SVG.\nYou are running Rapha\u00ebl "+this.version};var Xa=function(g,a){var b=v("path");a.canvas&&a.canvas.appendChild(b);b=new E(b,a);b.type="path";Z(b,{fill:"none",stroke:"#000",path:g});return b},ga=function(g,a,b){var s="linear",h=0.5,d=0.5,c=g.style,a=C(a).replace(Ma,function(g,a,b){s="radial";a&&b&&(h=x(a),d=x(b),g=2*(0.5<d)-1,0.25<G(h-0.5,2)+G(d-0.5,2)&&(d=B.sqrt(0.25-G(h-0.5,2))*
g+0.5)&&0.5!=d&&(d=d.toFixed(5)-1E-5*g));return""}),a=a.split(/\s*\-\s*/);if("linear"==s){var e=a.shift(),e=-x(e);if(isNaN(e))return null;var e=[0,0,B.cos(e*P/180),B.sin(e*P/180)],k=1/(Q(J(e[2]),J(e[3]))||1);e[2]*=k;e[3]*=k;0>e[2]&&(e[0]=-e[2],e[2]=0);0>e[3]&&(e[1]=-e[3],e[3]=0)}a=Qa(a);if(!a)return null;k=g.getAttribute("fill");(k=k.match(/^url\(#(.*)\)$/))&&b.defs.removeChild(q.getElementById(k[1]));k=v(s+"Gradient");k.id=l();v(k,"radial"==s?{fx:h,fy:d}:{x1:e[0],y1:e[1],x2:e[2],y2:e[3]});b.defs.appendChild(k);
b=0;for(e=a[t];b<e;b++){var j=v("stop");v(j,{offset:a[b].offset?a[b].offset:b?"100%":"0%","stop-color":a[b].color||"#fff"});k.appendChild(j)}v(g,{fill:"url(#"+k.id+")",opacity:1,"fill-opacity":1});c.fill="";c.opacity=1;return c.fillOpacity=1},Ba=function(g){var a=g.getBBox();v(g.pattern,{patternTransform:e.format("translate({0},{1})",a.x,a.y)})},Z=function(a,b){var f={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,
1,3],"--..":[8,3,1,3,1,3]},s=a.node,h=a.attrs,d=a.rotate(),c=function(a,g){if(g=f[ba.call(g)]){for(var d=a.attrs["stroke-width"]||"1",c={round:d,square:d,butt:0}[a.attrs["stroke-linecap"]||b["stroke-linecap"]]||0,h=[],i=g[t];i--;)h[i]=g[i]*d+(i%2?1:-1)*c;v(s,{"stroke-dasharray":h[L](",")})}};b[p]("rotation")&&(d=b.rotation);var m=C(d).split(u);m.length-1?(m[1]=+m[1],m[2]=+m[2]):m=null;x(d)&&a.rotate(0,!0);for(var k in b)if(b[p](k)&&ka[p](k)){var j=b[k];h[k]=j;switch(k){case "blur":a.blur(j);break;
case "rotation":a.rotate(j,!0);break;case "href":case "title":case "target":var A=s.parentNode;if("a"!=ba.call(A.tagName)){var n=v("a");A.insertBefore(n,s);n.appendChild(s);A=n}"target"==k&&"blank"==j?A.setAttributeNS(a.paper.xlink,"show","new"):A.setAttributeNS(a.paper.xlink,k,j);break;case "cursor":s.style.cursor=j;break;case "clip-rect":A=C(j).split(u);if(4==A[t]){a.clip&&a.clip.parentNode.parentNode.removeChild(a.clip.parentNode);var S=v("clipPath"),n=v("rect");S.id=l();v(n,{x:A[0],y:A[1],width:A[2],
height:A[3]});S.appendChild(n);a.paper.defs.appendChild(S);v(s,{"clip-path":"url(#"+S.id+")"});a.clip=n}j||((j=q.getElementById(s.getAttribute("clip-path").replace(/(^url\(#|\)$)/g,"")))&&j.parentNode.removeChild(j),v(s,{"clip-path":""}),delete a.clip);break;case "path":"path"==a.type&&v(s,{d:j?h.path=ea(j):"M0,0"});break;case "width":if(s.setAttribute(k,j),h.fx)k="x",j=h.x;else break;case "x":h.fx&&(j=-h.x-(h.width||0));case "rx":if("rx"==k&&"rect"==a.type)break;case "cx":m&&("x"==k||"cx"==k)&&(m[1]+=
j-h[k]);s.setAttribute(k,j);a.pattern&&Ba(a);break;case "height":if(s.setAttribute(k,j),h.fy)k="y",j=h.y;else break;case "y":h.fy&&(j=-h.y-(h.height||0));case "ry":if("ry"==k&&"rect"==a.type)break;case "cy":m&&("y"==k||"cy"==k)&&(m[2]+=j-h[k]);s.setAttribute(k,j);a.pattern&&Ba(a);break;case "r":"rect"==a.type?v(s,{rx:j,ry:j}):s.setAttribute(k,j);break;case "src":"image"==a.type&&s.setAttributeNS(a.paper.xlink,"href",j);break;case "stroke-width":s.style.strokeWidth=j;s.setAttribute(k,j);h["stroke-dasharray"]&&
c(a,h["stroke-dasharray"]);break;case "stroke-dasharray":c(a,j);break;case "translation":j=C(j).split(u);j[0]=+j[0]||0;j[1]=+j[1]||0;m&&(m[1]+=j[0],m[2]+=j[1]);ra.call(a,j[0],j[1]);break;case "scale":j=C(j).split(u);a.scale(+j[0]||1,+j[1]||+j[0]||1,isNaN(x(j[2]))?null:+j[2],isNaN(x(j[3]))?null:+j[3]);break;case "fill":if(A=C(j).match(La)){var S=v("pattern"),r=v("image");S.id=l();v(S,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1});v(r,{x:0,y:0});r.setAttributeNS(a.paper.xlink,"href",A[1]);
S.appendChild(r);j=q.createElement("img");j.style.cssText="position:absolute;left:-9999em;top-9999em";j.onload=function(){v(S,{width:this.offsetWidth,height:this.offsetHeight});v(r,{width:this.offsetWidth,height:this.offsetHeight});q.body.removeChild(this);a.paper.safari()};q.body.appendChild(j);j.src=A[1];a.paper.defs.appendChild(S);s.style.fill="url(#"+S.id+")";v(s,{fill:"url(#"+S.id+")"});a.pattern=S;a.pattern&&Ba(a);break}A=e.getRGB(j);if(A.error){if(({circle:1,ellipse:1}[p](a.type)||"r"!=C(j).charAt())&&
ga(s,j,a.paper)){h.gradient=j;h.fill="none";break}}else delete b.gradient,delete h.gradient,!e.is(h.opacity,"undefined")&&e.is(b.opacity,"undefined")&&v(s,{opacity:h.opacity}),!e.is(h["fill-opacity"],"undefined")&&e.is(b["fill-opacity"],"undefined")&&v(s,{"fill-opacity":h["fill-opacity"]});A[p]("opacity")&&v(s,{"fill-opacity":1<A.opacity?A.opacity/100:A.opacity});case "stroke":A=e.getRGB(j);s.setAttribute(k,A.hex);"stroke"==k&&A[p]("opacity")&&v(s,{"stroke-opacity":1<A.opacity?A.opacity/100:A.opacity});
break;case "gradient":({circle:1,ellipse:1}[p](a.type)||"r"!=C(j).charAt())&&ga(s,j,a.paper);break;case "opacity":h.gradient&&!h[p]("stroke-opacity")&&v(s,{"stroke-opacity":1<j?j/100:j});case "fill-opacity":if(h.gradient){if(A=q.getElementById(s.getAttribute("fill").replace(/^url\(#|\)$/g,"")))A=A.getElementsByTagName("stop"),A[A[t]-1].setAttribute("stop-opacity",j);break}default:"font-size"==k&&(j=Y(j,10)+"px"),A=k.replace(/(\-.)/g,function(a){return ja.call(a.substring(1))}),s.style[A]=j,s.setAttribute(k,
j)}}if("text"==a.type&&(b[p]("text")||b[p]("font")||b[p]("font-size")||b[p]("x")||b[p]("y"))){h=a.attrs;c=a.node;k=c.firstChild?Y(q.defaultView.getComputedStyle(c.firstChild,"").getPropertyValue("font-size"),10):10;if(b[p]("text")){for(h.text=b.text;c.firstChild;)c.removeChild(c.firstChild);j=C(b.text).split("\n");A=0;for(n=j[t];A<n;A++)if(j[A]){var D=v("tspan");A&&v(D,{dy:k*Ya,x:h.x});D.appendChild(q.createTextNode(j[A]));c.appendChild(D)}}else{j=c.getElementsByTagName("tspan");A=0;for(n=j[t];A<
n;A++)A&&v(j[A],{dy:k*Ya,x:h.x})}v(c,{y:h.y});k=a.getBBox();(k=h.y-(k.y+k.height/2))&&e.is(k,"finite")&&v(c,{y:h.y+k})}m?a.rotate(m.join(I)):x(d)&&a.rotate(d,!0)},Ya=1.2,E=function(a,b){this[0]=a;this.id=e._oid++;this.node=a;a.raphael=this;this.paper=b;this.attrs=this.attrs||{};this.transformations=[];this._={tx:0,ty:0,rt:{deg:0,cx:0,cy:0},sx:1,sy:1};!b.bottom&&(b.bottom=this);(this.prev=b.top)&&(b.top.next=this);b.top=this;this.next=null},w=E[m];E[m].rotate=function(a,b,f){if(this.removed)return this;
if(null==a)return this._.rt.cx?[this._.rt.deg,this._.rt.cx,this._.rt.cy][L](I):this._.rt.deg;var c=this.getBBox(),a=C(a).split(u);a[t]-1&&(b=x(a[1]),f=x(a[2]));a=x(a[0]);null!=b&&!1!==b?this._.rt.deg=a:this._.rt.deg+=a;null==f&&(b=null);this._.rt.cx=b;this._.rt.cy=f;b=null==b?c.x+c.width/2:b;f=null==f?c.y+c.height/2:f;this._.rt.deg?(this.transformations[0]=e.format("rotate({0} {1} {2})",this._.rt.deg,b,f),this.clip&&v(this.clip,{transform:e.format("rotate({0} {1} {2})",-this._.rt.deg,b,f)})):(this.transformations[0]=
"",this.clip&&v(this.clip,{transform:""}));v(this.node,{transform:this.transformations[L](I)});return this};E[m].hide=function(){!this.removed&&(this.node.style.display="none");return this};E[m].show=function(){!this.removed&&(this.node.style.display="");return this};E[m].remove=function(){if(!this.removed){da(this,this.paper);this.node.parentNode.removeChild(this.node);for(var a in this)delete this[a];this.removed=!0}};E[m].getBBox=function(){if(this.removed)return this;if("path"==this.type)return pa(this.attrs.path);
if("none"==this.node.style.display){this.show();var a=!0}var b={};try{b=this.node.getBBox()}catch(f){}finally{b=b||{}}if("text"==this.type)for(var b={x:b.x,y:Infinity,width:0,height:0},c=0,h=this.node.getNumberOfChars();c<h;c++){var d=this.node.getExtentOfChar(c);d.y<b.y&&(b.y=d.y);d.y+d.height-b.y>b.height&&(b.height=d.y+d.height-b.y);d.x+d.width-b.x>b.width&&(b.width=d.x+d.width-b.x)}a&&this.hide();return b};E[m].attr=function(a,b){if(this.removed)return this;if(null==a){var f={},c;for(c in this.attrs)this.attrs[p](c)&&
(f[c]=this.attrs[c]);this._.rt.deg&&(f.rotation=this.rotate());(1!=this._.sx||1!=this._.sy)&&(f.scale=this.scale());f.gradient&&"none"==f.fill&&(f.fill=f.gradient)&&delete f.gradient;return f}if(null==b&&e.is(a,"string"))return"translation"==a?ra.call(this):"rotation"==a?this.rotate():"scale"==a?this.scale():"fill"==a&&"none"==this.attrs.fill&&this.attrs.gradient?this.attrs.gradient:this.attrs[a];if(null==b&&e.is(a,R)){c={};for(var f=0,h=a.length;f<h;f++)c[a[f]]=this.attr(a[f]);return c}null!=b?(f=
{},f[a]=b):null!=a&&e.is(a,"object")&&(f=a);for(h in this.paper.customAttributes)if(this.paper.customAttributes[p](h)&&f[p](h)&&e.is(this.paper.customAttributes[h],"function")){c=this.paper.customAttributes[h].apply(this,[].concat(f[h]));this.attrs[h]=f[h];for(var d in c)c[p](d)&&(f[d]=c[d])}Z(this,f);return this};E[m].toFront=function(){if(this.removed)return this;this.node.parentNode.appendChild(this.node);var a=this.paper;a.top!=this&&Sa(this,a);return this};E[m].toBack=function(){if(this.removed)return this;
this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),Ta(this,this.paper));return this};E[m].insertAfter=function(a){if(this.removed)return this;var b=a.node||a[a.length-1].node;b.nextSibling?b.parentNode.insertBefore(this.node,b.nextSibling):b.parentNode.appendChild(this.node);Ua(this,a,this.paper);return this};E[m].insertBefore=function(a){if(this.removed)return this;var b=a.node||a[0].node;b.parentNode.insertBefore(this.node,b);
Va(this,a,this.paper);return this};E[m].blur=function(a){if(0!==+a){var b=v("filter"),f=v("feGaussianBlur");this.attrs.blur=a;b.id=l();v(f,{stdDeviation:+a||1.5});b.appendChild(f);this.paper.defs.appendChild(b);this._blur=b;v(this.node,{filter:"url(#"+b.id+")"})}else this._blur&&(this._blur.parentNode.removeChild(this._blur),delete this._blur,delete this.attrs.blur),this.node.removeAttribute("filter")};var Za=function(a,b,f,c){var h=v("circle");a.canvas&&a.canvas.appendChild(h);a=new E(h,a);a.attrs=
{cx:b,cy:f,r:c,fill:"none",stroke:"#000"};a.type="circle";v(h,a.attrs);return a},$a=function(a,b,f,c,h,d){var i=v("rect");a.canvas&&a.canvas.appendChild(i);a=new E(i,a);a.attrs={x:b,y:f,width:c,height:h,r:d||0,rx:d||0,ry:d||0,fill:"none",stroke:"#000"};a.type="rect";v(i,a.attrs);return a},ab=function(a,b,f,c,h){var d=v("ellipse");a.canvas&&a.canvas.appendChild(d);a=new E(d,a);a.attrs={cx:b,cy:f,rx:c,ry:h,fill:"none",stroke:"#000"};a.type="ellipse";v(d,a.attrs);return a},bb=function(a,b,f,c,h,d){var i=
v("image");v(i,{x:f,y:c,width:h,height:d,preserveAspectRatio:"none"});i.setAttributeNS(a.xlink,"href",b);a.canvas&&a.canvas.appendChild(i);a=new E(i,a);a.attrs={x:f,y:c,width:h,height:d,src:b};a.type="image";return a},cb=function(a,b,f,c){var h=v("text");v(h,{x:b,y:f,"text-anchor":"middle"});a.canvas&&a.canvas.appendChild(h);a=new E(h,a);a.attrs={x:b,y:f,"text-anchor":"middle",text:c,font:ka.font,stroke:"none",fill:"#000"};a.type="text";Z(a,a.attrs);return a},db=function(a,b){this.width=a||this.width;
this.height=b||this.height;this.canvas.setAttribute("width",this.width);this.canvas.setAttribute("height",this.height);return this},ua=function(){var a=Ra[H](0,arguments),b=a&&a.container,f=a.x,c=a.y,h=a.width,a=a.height;if(!b)throw Error("SVG container not found.");var d=v("svg"),f=f||0,c=c||0,h=h||512,a=a||342;v(d,{xmlns:"http://www.w3.org/2000/svg",version:1.1,width:h,height:a});1==b?(d.style.cssText="position:absolute;left:"+f+"px;top:"+c+"px",q.body.appendChild(d)):b.firstChild?b.insertBefore(d,
b.firstChild):b.appendChild(d);b=new ca;b.width=h;b.height=a;b.canvas=d;Aa.call(b,b,e.fn);b.clear();return b};y.clear=function(){for(var a=this.canvas;a.firstChild;)a.removeChild(a.firstChild);this.bottom=this.top=null;(this.desc=v("desc")).appendChild(q.createTextNode("Created with Rapha\u00ebl"));a.appendChild(this.desc);a.appendChild(this.defs=v("defs"))};y.remove=function(){this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var a in this)this[a]=Wa(a)}}if(e.vml){var eb=
{M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},zb=/([clmz]),?([^clmz]*)/gi,Ab=/ progid:\S+Blur\([^\)]+\)/g,Bb=/-?[^,\s-]+/g,ha=1E3+I+1E3,ia={path:1,rect:1};e[X]=function(){return"Your browser doesn\u2019t support SVG. Falling down to VML.\nYou are running Rapha\u00ebl "+this.version};Xa=function(a,b){var f=K("group");f.style.cssText="position:absolute;left:0;top:0;width:"+b.width+"px;height:"+b.height+"px";f.coordsize=b.coordsize;f.coordorigin=b.coordorigin;var c=K("shape"),h=c.style;h.width=b.width+
"px";h.height=b.height+"px";c.coordsize=ha;c.coordorigin=b.coordorigin;f.appendChild(c);var h=new E(c,f,b),d={fill:"none",stroke:"#000"};a&&(d.path=a);h.type="path";h.path=[];h.Path="";Z(h,d);b.canvas.appendChild(f);f=K("skew");f.on=!0;c.appendChild(f);h.skew=f;return h};Z=function(a,b){a.attrs=a.attrs||{};var f=a.node,c=a.attrs,h=f.style,d,i=(b.x!=c.x||b.y!=c.y||b.width!=c.width||b.height!=c.height||b.r!=c.r)&&"rect"==a.type,m;for(m in b)b[p](m)&&(c[m]=b[m]);i&&(c.path=fb(c.x,c.y,c.width,c.height,
c.r),a.X=c.x,a.Y=c.y,a.W=c.width,a.H=c.height);b.href&&(f.href=b.href);b.title&&(f.title=b.title);b.target&&(f.target=b.target);b.cursor&&(h.cursor=b.cursor);"blur"in b&&a.blur(b.blur);if(b.path&&"path"==a.type||i){i=f;m=c.path;var k=/[ahqstv]/ig,j=ea;C(m).match(k)&&(j=oa);k=/[clmz]/g;if(j==ea&&!C(m).match(k))m=C(m).replace(zb,function(a,b,g){var f=[],d="m"==ba.call(b),c=eb[b];g.replace(Bb,function(a){d&&2==f[t]&&(c+=f+eb["m"==b?"l":"L"],f=[]);f[F](N(10*a))});return c+f});else{var k=j(m),l;m=[];for(var n=
0,S=k[t];n<S;n++){j=k[n];l=ba.call(k[n][0]);"z"==l&&(l="x");for(var r=1,D=j[t];r<D;r++)l+=N(10*j[r])+(r!=D-1?",":"");m[F](l)}m=m[L](I)}i.path=m}null!=b.rotation&&a.rotate(b.rotation,!0);b.translation&&(d=C(b.translation).split(u),ra.call(a,d[0],d[1]),null!=a._.rt.cx&&(a._.rt.cx+=+d[0],a._.rt.cy+=+d[1],a.setBox(a.attrs,d[0],d[1])));b.scale&&(d=C(b.scale).split(u),a.scale(+d[0]||1,+d[1]||+d[0]||1,+d[2]||null,+d[3]||null));"clip-rect"in b&&(d=C(b["clip-rect"]).split(u),4==d[t]&&(d[2]=+d[2]+ +d[0],d[3]=
+d[3]+ +d[1],i=f.clipRect||q.createElement("div"),m=i.style,k=f.parentNode,m.clip=e.format("rect({1}px {2}px {3}px {0}px)",d),f.clipRect||(m.position="absolute",m.top=0,m.left=0,m.width=a.paper.width+"px",m.height=a.paper.height+"px",k.parentNode.insertBefore(i,k),i.appendChild(k),f.clipRect=i)),b["clip-rect"]||f.clipRect&&(f.clipRect.style.clip=""));"image"==a.type&&b.src&&(f.src=b.src);"image"==a.type&&b.opacity&&(f.filterOpacity=" progid:DXImageTransform.Microsoft.Alpha(opacity="+100*b.opacity+
")",h.filter=(f.filterMatrix||"")+(f.filterOpacity||""));b.font&&(h.font=b.font);b["font-family"]&&(h.fontFamily='"'+b["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,"")+'"');b["font-size"]&&(h.fontSize=b["font-size"]);b["font-weight"]&&(h.fontWeight=b["font-weight"]);b["font-style"]&&(h.fontStyle=b["font-style"]);if(null!=b.opacity||null!=b["stroke-width"]||null!=b.fill||null!=b.stroke||null!=b["stroke-width"]||null!=b["stroke-opacity"]||null!=b["fill-opacity"]||null!=b["stroke-dasharray"]||
null!=b["stroke-miterlimit"]||null!=b["stroke-linejoin"]||null!=b["stroke-linecap"]){f=a.shape||f;d=f.getElementsByTagName("fill")&&f.getElementsByTagName("fill")[0];i=!1;!d&&(i=d=K("fill"));if("fill-opacity"in b||"opacity"in b)h=((+c["fill-opacity"]+1||2)-1)*((+c.opacity+1||2)-1)*((+e.getRGB(b.fill).o+1||2)-1),h=W(Q(h,0),1),d.opacity=h;b.fill&&(d.on=!0);if(null==d.on||"none"==b.fill)d.on=!1;d.on&&b.fill&&((h=b.fill.match(La))?(d.src=h[1],d.type="tile"):(d.color=e.getRGB(b.fill).hex,d.src="",d.type=
"solid",e.getRGB(b.fill).error&&(a.type in{circle:1,ellipse:1}||"r"!=C(b.fill).charAt())&&ga(a,b.fill)&&(c.fill="none",c.gradient=b.fill)));i&&f.appendChild(d);d=f.getElementsByTagName("stroke")&&f.getElementsByTagName("stroke")[0];i=!1;!d&&(i=d=K("stroke"));if(b.stroke&&"none"!=b.stroke||b["stroke-width"]||null!=b["stroke-opacity"]||b["stroke-dasharray"]||b["stroke-miterlimit"]||b["stroke-linejoin"]||b["stroke-linecap"])d.on=!0;("none"==b.stroke||null==d.on||0==b.stroke||0==b["stroke-width"])&&(d.on=
!1);h=e.getRGB(b.stroke);d.on&&b.stroke&&(d.color=h.hex);h=((+c["stroke-opacity"]+1||2)-1)*((+c.opacity+1||2)-1)*((+h.o+1||2)-1);m=0.75*(x(b["stroke-width"])||1);h=W(Q(h,0),1);null==b["stroke-width"]&&(m=c["stroke-width"]);b["stroke-width"]&&(d.weight=m);m&&1>m&&(h*=m)&&(d.weight=1);d.opacity=h;b["stroke-linejoin"]&&(d.joinstyle=b["stroke-linejoin"]||"miter");d.miterlimit=b["stroke-miterlimit"]||8;b["stroke-linecap"]&&(d.endcap="butt"==b["stroke-linecap"]?"flat":"square"==b["stroke-linecap"]?"square":
"round");b["stroke-dasharray"]&&(h={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"},d.dashstyle=h[p](b["stroke-dasharray"])?h[b["stroke-dasharray"]]:"");i&&f.appendChild(d)}if("text"==a.type)switch(h=a.paper.span.style,c.font&&(h.font=c.font),c["font-family"]&&(h.fontFamily=c["font-family"]),c["font-size"]&&(h.fontSize=c["font-size"]),c["font-weight"]&&(h.fontWeight=c["font-weight"]),
c["font-style"]&&(h.fontStyle=c["font-style"]),a.node.string&&(a.paper.span.innerHTML=C(a.node.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>")),a.W=c.w=a.paper.span.offsetWidth,a.H=c.h=a.paper.span.offsetHeight,a.X=c.x,a.Y=c.y+N(a.H/2),c["text-anchor"]){case "start":a.node.style["v-text-align"]="left";a.bbx=N(a.W/2);break;case "end":a.node.style["v-text-align"]="right";a.bbx=-N(a.W/2);break;default:a.node.style["v-text-align"]="center"}};ga=function(a,b){a.attrs=a.attrs||
{};var f,c="linear",h=".5 .5";a.attrs.gradient=b;b=C(b).replace(Ma,function(a,b,g){c="radial";b&&g&&(b=x(b),g=x(g),0.25<G(b-0.5,2)+G(g-0.5,2)&&(g=B.sqrt(0.25-G(b-0.5,2))*(2*(0.5<g)-1)+0.5),h=b+I+g);return""});b=b.split(/\s*\-\s*/);if("linear"==c){var d=b.shift(),d=-x(d);if(isNaN(d))return null}var i=Qa(b);if(!i)return null;a=a.shape||a.node;f=a.getElementsByTagName("fill")[0]||K("fill");!f.parentNode&&a.appendChild(f);if(i[t]){f.on=!0;f.method="none";f.color=i[0].color;f.color2=i[i[t]-1].color;for(var e=
[],k=0,j=i[t];k<j;k++)i[k].offset&&e[F](i[k].offset+I+i[k].color);f.colors&&(f.colors.value=e[t]?e[L]():"0% "+f.color);"radial"==c?(f.type="gradientradial",f.focus="100%",f.focussize=h,f.focusposition=h):(f.type="gradient",f.angle=(270-d)%360)}return 1};E=function(a,b,f){this[0]=a;this.id=e._oid++;this.node=a;a.raphael=this;this.Y=this.X=0;this.attrs={};this.Group=b;this.paper=f;this._={tx:0,ty:0,rt:{deg:0},sx:1,sy:1};!f.bottom&&(f.bottom=this);(this.prev=f.top)&&(f.top.next=this);f.top=this;this.next=
null};w=E[m];w.rotate=function(a,b,f){if(this.removed)return this;if(null==a)return this._.rt.cx?[this._.rt.deg,this._.rt.cx,this._.rt.cy][L](I):this._.rt.deg;a=C(a).split(u);a[t]-1&&(b=x(a[1]),f=x(a[2]));a=x(a[0]);null!=b?this._.rt.deg=a:this._.rt.deg+=a;null==f&&(b=null);this._.rt.cx=b;this._.rt.cy=f;this.setBox(this.attrs,b,f);this.Group.style.rotation=this._.rt.deg;return this};w.setBox=function(a,b,f){if(this.removed)return this;var c=this.Group.style,h=this.shape&&this.shape.style||this.node.style,
a=a||{},d;for(d in a)a[p](d)&&(this.attrs[d]=a[d]);var b=b||this._.rt.cx,f=f||this._.rt.cy,i=this.attrs,e;switch(this.type){case "circle":a=i.cx-i.r;d=i.cy-i.r;e=i=2*i.r;break;case "ellipse":a=i.cx-i.rx;d=i.cy-i.ry;e=2*i.rx;i=2*i.ry;break;case "image":a=+i.x;d=+i.y;e=i.width||0;i=i.height||0;break;case "text":this.textpath.v=["m",N(i.x),", ",N(i.y-2),"l",N(i.x)+1,", ",N(i.y-2)][L]("");a=i.x-N(this.W/2);d=i.y-this.H/2;e=this.W;i=this.H;break;case "rect":case "path":this.attrs.path?(i=pa(this.attrs.path),
a=i.x,d=i.y,e=i.width,i=i.height):(d=a=0,e=this.paper.width,i=this.paper.height);break;default:d=a=0,e=this.paper.width,i=this.paper.height}var b=(null==b?a+e/2:b)-this.paper.width/2,f=(null==f?d+i/2:f)-this.paper.height/2,k;c.left!=(k=b+"px")&&(c.left=k);c.top!=(k=f+"px")&&(c.top=k);this.X=ia[p](this.type)?-b:a;this.Y=ia[p](this.type)?-f:d;this.W=e;this.H=i;ia[p](this.type)?(h.left!=(k=10*-b+"px")&&(h.left=k),h.top!=(k=10*-f+"px")&&(h.top=k)):"text"==this.type?(h.left!=(k=-b+"px")&&(h.left=k),h.top!=
(k=-f+"px")&&(h.top=k)):(c.width!=(k=this.paper.width+"px")&&(c.width=k),c.height!=(k=this.paper.height+"px")&&(c.height=k),h.left!=(k=a-b+"px")&&(h.left=k),h.top!=(k=d-f+"px")&&(h.top=k),h.width!=(k=e+"px")&&(h.width=k),h.height!=(k=i+"px")&&(h.height=k))};w.hide=function(){!this.removed&&(this.Group.style.display="none");return this};w.show=function(){!this.removed&&(this.Group.style.display="block");return this};w.getBBox=function(){return this.removed?this:ia[p](this.type)?pa(this.attrs.path):
{x:this.X+(this.bbx||0),y:this.Y,width:this.W,height:this.H}};w.remove=function(){if(!this.removed){da(this,this.paper);this.node.parentNode.removeChild(this.node);this.Group.parentNode.removeChild(this.Group);this.shape&&this.shape.parentNode.removeChild(this.shape);for(var a in this)delete this[a];this.removed=!0}};w.attr=function(a,b){if(this.removed)return this;if(null==a){var f={},c;for(c in this.attrs)this.attrs[p](c)&&(f[c]=this.attrs[c]);this._.rt.deg&&(f.rotation=this.rotate());(1!=this._.sx||
1!=this._.sy)&&(f.scale=this.scale());f.gradient&&"none"==f.fill&&(f.fill=f.gradient)&&delete f.gradient;return f}if(null==b&&e.is(a,"string"))return"translation"==a?ra.call(this):"rotation"==a?this.rotate():"scale"==a?this.scale():"fill"==a&&"none"==this.attrs.fill&&this.attrs.gradient?this.attrs.gradient:this.attrs[a];if(this.attrs&&null==b&&e.is(a,R)){var h={};c=0;for(f=a[t];c<f;c++)h[a[c]]=this.attr(a[c]);return h}null!=b&&(f={},f[a]=b);null==b&&e.is(a,"object")&&(f=a);if(f){for(h in this.paper.customAttributes)if(this.paper.customAttributes[p](h)&&
f[p](h)&&e.is(this.paper.customAttributes[h],"function")){c=this.paper.customAttributes[h].apply(this,[].concat(f[h]));this.attrs[h]=f[h];for(var d in c)c[p](d)&&(f[d]=c[d])}f.text&&"text"==this.type&&(this.node.string=f.text);Z(this,f);f.gradient&&({circle:1,ellipse:1}[p](this.type)||"r"!=C(f.gradient).charAt())&&ga(this,f.gradient);(!ia[p](this.type)||this._.rt.deg)&&this.setBox(this.attrs)}return this};w.toFront=function(){!this.removed&&this.Group.parentNode.appendChild(this.Group);this.paper.top!=
this&&Sa(this,this.paper);return this};w.toBack=function(){if(this.removed)return this;this.Group.parentNode.firstChild!=this.Group&&(this.Group.parentNode.insertBefore(this.Group,this.Group.parentNode.firstChild),Ta(this,this.paper));return this};w.insertAfter=function(a){if(this.removed)return this;a.constructor==T&&(a=a[a.length-1]);a.Group.nextSibling?a.Group.parentNode.insertBefore(this.Group,a.Group.nextSibling):a.Group.parentNode.appendChild(this.Group);Ua(this,a,this.paper);return this};w.insertBefore=
function(a){if(this.removed)return this;a.constructor==T&&(a=a[0]);a.Group.parentNode.insertBefore(this.Group,a.Group);Va(this,a,this.paper);return this};w.blur=function(a){var b=this.node.runtimeStyle,f=b.filter,f=f.replace(Ab,"");0!==+a?(this.attrs.blur=a,b.filter=f+I+" progid:DXImageTransform.Microsoft.Blur(pixelradius="+(+a||1.5)+")",b.margin=e.format("-{0}px 0 0 -{0}px",N(+a||1.5))):(b.filter=f,b.margin=0,delete this.attrs.blur)};var Za=function(a,b,f,c){var h=K("group"),d=K("oval");h.style.cssText=
"position:absolute;left:0;top:0;width:"+a.width+"px;height:"+a.height+"px";h.coordsize=ha;h.coordorigin=a.coordorigin;h.appendChild(d);d=new E(d,h,a);d.type="circle";Z(d,{stroke:"#000",fill:"none"});d.attrs.cx=b;d.attrs.cy=f;d.attrs.r=c;d.setBox({x:b-c,y:f-c,width:2*c,height:2*c});a.canvas.appendChild(h);return d},fb=function(a,b,f,c,h){return h?e.format("M{0},{1}l{2},0a{3},{3},0,0,1,{3},{3}l0,{5}a{3},{3},0,0,1,{4},{3}l{6},0a{3},{3},0,0,1,{4},{4}l0,{7}a{3},{3},0,0,1,{3},{4}z",a+h,b,f-2*h,h,-h,c-2*
h,2*h-f,2*h-c):e.format("M{0},{1}l{2},0,0,{3},{4},0z",a,b,f,c,-f)},$a=function(a,b,f,c,h,d){var i=fb(b,f,c,h,d),a=a.path(i),e=a.attrs;a.X=e.x=b;a.Y=e.y=f;a.W=e.width=c;a.H=e.height=h;e.r=d;e.path=i;a.type="rect";return a},ab=function(a,b,f,c,h){var d=K("group"),e=K("oval");d.style.cssText="position:absolute;left:0;top:0;width:"+a.width+"px;height:"+a.height+"px";d.coordsize=ha;d.coordorigin=a.coordorigin;d.appendChild(e);e=new E(e,d,a);e.type="ellipse";Z(e,{stroke:"#000"});e.attrs.cx=b;e.attrs.cy=
f;e.attrs.rx=c;e.attrs.ry=h;e.setBox({x:b-c,y:f-h,width:2*c,height:2*h});a.canvas.appendChild(d);return e},bb=function(a,b,f,c,h,d){var e=K("group"),m=K("image");e.style.cssText="position:absolute;left:0;top:0;width:"+a.width+"px;height:"+a.height+"px";e.coordsize=ha;e.coordorigin=a.coordorigin;m.src=b;e.appendChild(m);var k=new E(m,e,a);k.type="image";k.attrs.src=b;k.attrs.x=f;k.attrs.y=c;k.attrs.w=h;k.attrs.h=d;k.setBox({x:f,y:c,width:h,height:d});a.canvas.appendChild(e);a=K("skew");a.on=!0;m.appendChild(a);
k.skew=a;return k},cb=function(a,b,f,c){var h=K("group"),d=K("shape"),i=d.style,m=K("path"),k=K("textpath");h.style.cssText="position:absolute;left:0;top:0;width:"+a.width+"px;height:"+a.height+"px";h.coordsize=ha;h.coordorigin=a.coordorigin;m.v=e.format("m{0},{1}l{2},{1}",N(10*b),N(10*f),N(10*b)+1);m.textpathok=!0;i.width=a.width;i.height=a.height;k.string=C(c);k.on=!0;d.appendChild(k);d.appendChild(m);h.appendChild(d);i=new E(k,h,a);i.shape=d;i.textpath=m;i.type="text";i.attrs.text=c;i.attrs.x=
b;i.attrs.y=f;i.attrs.w=1;i.attrs.h=1;Z(i,{font:ka.font,stroke:"none",fill:"#000"});i.setBox();a.canvas.appendChild(h);return i},db=function(a,b){var f=this.canvas.style;a==+a&&(a+="px");b==+b&&(b+="px");f.width=a;f.height=b;f.clip="rect(0 "+a+" "+b+" 0)";return this},K;q.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!q.namespaces.rvml&&q.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),K=function(a){return q.createElement("<rvml:"+a+' class="rvml">')}}catch(Hb){K=function(a){return q.createElement("<"+
a+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}ua=function(){var a=Ra[H](0,arguments),b=a.container,f=a.height,c=a.width,h=a.x,a=a.y;if(!b)throw Error("VML container not found.");var d=new ca,i=d.canvas=q.createElement("div"),m=i.style,h=h||0,a=a||0,c=c||512,f=f||342;c==+c&&(c+="px");f==+f&&(f+="px");d.width=1E3;d.height=1E3;d.coordsize=1E4+I+1E4;d.coordorigin="0 0";d.span=q.createElement("span");d.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;";
i.appendChild(d.span);m.cssText=e.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",c,f);1==b?(q.body.appendChild(i),m.left=h+"px",m.top=a+"px",m.position="absolute"):b.firstChild?b.insertBefore(i,b.firstChild):b.appendChild(i);Aa.call(d,d,e.fn);return d};y.clear=function(){this.canvas.innerHTML="";this.span=q.createElement("span");this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;";
this.canvas.appendChild(this.span);this.bottom=this.top=null};y.remove=function(){this.canvas.parentNode.removeChild(this.canvas);for(var a in this)this[a]=Wa(a);return!0}}var gb=navigator.userAgent.match(/Version\/(.*?)\s/);"Apple Computer, Inc."==navigator.vendor&&(gb&&4>gb[1]||"iP"==navigator.platform.slice(0,2))?y.safari=function(){var a=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});D.setTimeout(function(){a.remove()})}:y.safari=function(){};var Cb=function(){this.returnValue=
!1},Db=function(){return this.originalEvent.preventDefault()},Eb=function(){this.cancelBubble=!0},Fb=function(){return this.originalEvent.stopPropagation()},hb;hb=q.addEventListener?function(a,b,f,c){var h=aa&&va[b]?va[b]:b,d=function(d){if(aa&&va[p](b))for(var h=0,e=d.targetTouches&&d.targetTouches.length;h<e;h++)if(d.targetTouches[h].target==a){e=d;d=d.targetTouches[h];d.originalEvent=e;d.preventDefault=Db;d.stopPropagation=Fb;break}return f.call(c,d)};a.addEventListener(h,d,!1);return function(){a.removeEventListener(h,
d,!1);return!0}}:q.attachEvent?function(a,b,f,c){var h=function(a){a=a||D.event;a.preventDefault=a.preventDefault||Cb;a.stopPropagation=a.stopPropagation||Eb;return f.call(c,a)};a.attachEvent("on"+b,h);return function(){a.detachEvent("on"+b,h);return!0}}:void 0;for(var U=[],Ca=function(a){for(var b=a.clientX,f=a.clientY,c=q.documentElement.scrollTop||q.body.scrollTop,h=q.documentElement.scrollLeft||q.body.scrollLeft,d,e=U.length;e--;){d=U[e];if(aa)for(var m=a.touches.length,k;m--;){if(k=a.touches[m],
k.identifier==d.el._drag.id){b=k.clientX;f=k.clientY;(a.originalEvent?a.originalEvent:a).preventDefault();break}}else a.preventDefault();b+=h;f+=c;d.move&&d.move.call(d.move_scope||d.el,b-d.el._drag.x,f-d.el._drag.y,b,f,a)}},Da=function(a){e.unmousemove(Ca).unmouseup(Da);for(var b=U.length,f;b--;)f=U[b],f.el._drag={},f.end&&f.end.call(f.end_scope||f.start_scope||f.move_scope||f.el,a);U=[]},ib=Ka[t];ib--;)(function(a){e[a]=E[m][a]=function(b,f){e.is(b,"function")&&(this.events=this.events||[],this.events.push({name:a,
f:b,unbind:hb(this.shape||this.node||q,a,b,f||this)}));return this};e["un"+a]=E[m]["un"+a]=function(b){for(var f=this.events,c=f[t];c--;)if(f[c].name==a&&f[c].f==b){f[c].unbind();f.splice(c,1);!f.length&&delete this.events;break}return this}})(Ka[ib]);w.hover=function(a,b,f,c){return this.mouseover(a,f).mouseout(b,c||f)};w.unhover=function(a,b){return this.unmouseover(a).unmouseout(b)};w.drag=function(a,b,f,c,h,d){this._drag={};this.mousedown(function(i){(i.originalEvent||i).preventDefault();var m=
q.documentElement.scrollTop||q.body.scrollTop,k=q.documentElement.scrollLeft||q.body.scrollLeft;this._drag.x=i.clientX+k;this._drag.y=i.clientY+m;this._drag.id=i.identifier;b&&b.call(h||c||this,i.clientX+k,i.clientY+m,i);!U.length&&e.mousemove(Ca).mouseup(Da);U.push({el:this,move:a,end:f,move_scope:c,start_scope:h,end_scope:d})});return this};w.undrag=function(a,b,f){for(b=U.length;b--;)U[b].el==this&&U[b].move==a&&U[b].end==f&&U.splice(b++,1);!U.length&&e.unmousemove(Ca).unmouseup(Da)};y.circle=
function(a,b,f){return Za(this,a||0,b||0,f||0)};y.rect=function(a,b,f,c,h){return $a(this,a||0,b||0,f||0,c||0,h||0)};y.ellipse=function(a,b,f,c){return ab(this,a||0,b||0,f||0,c||0)};y.path=function(a){a&&!e.is(a,"string")&&!e.is(a[0],R)&&(a+="");return Xa(e.format[H](e,arguments),this)};y.image=function(a,b,f,c,h){return bb(this,a||"about:blank",b||0,f||0,c||0,h||0)};y.text=function(a,b,f){return cb(this,a||0,b||0,C(f))};y.set=function(a){1<arguments[t]&&(a=Array[m].splice.call(arguments,0,arguments[t]));
return new T(a)};y.setSize=db;y.top=y.bottom=null;y.raphael=e;w.resetScale=function(){if(this.removed)return this;this._.sx=1;this._.sy=1;this.attrs.scale="1 1"};w.scale=function(a,c,f,e){if(this.removed)return this;if(null==a&&null==c)return{x:this._.sx,y:this._.sy,toString:b};c=c||a;!+c&&(c=a);var h,d,i=this.attrs;if(0!=a){var m=this.getBBox(),k=m.x+m.width/2,j=m.y+m.height/2,p=J(a/this._.sx),l=J(c/this._.sy),f=+f||0==f?f:k,e=+e||0==e?e:j,q=0<this._.sx,n=0<this._.sy,m=~~(a/J(a)),u=~~(c/J(c)),r=
p*m,D=l*u,v=this.node.style,k=f+J(k-f)*r*(k>f==q?1:-1),j=e+J(j-e)*D*(j>e==n?1:-1),x=a*m>c*u?l:p;switch(this.type){case "rect":case "image":var B=i.width*p,C=i.height*l;this.attr({height:C,r:i.r*x,width:B,x:k-B/2,y:j-C/2});break;case "circle":case "ellipse":this.attr({rx:i.rx*p,ry:i.ry*l,r:i.r*x,cx:k,cy:j});break;case "text":this.attr({x:k,y:j});break;case "path":x=za(i.path);h=!0;d=q?r:p;n=n?D:l;D=0;for(q=x[t];D<q;D++){var r=x[D],w=ja.call(r[0]);if(!("M"==w&&h))if(h=!1,"A"==w)r[x[D][t]-2]*=d,r[x[D][t]-
1]*=n,r[1]*=p,r[2]*=l,r[5]=+(m+u?!!+r[5]:!+r[5]);else if("H"==w)for(var w=1,y=r[t];w<y;w++)r[w]*=d;else if("V"==w){w=1;for(y=r[t];w<y;w++)r[w]*=n}else{w=1;for(y=r[t];w<y;w++)r[w]*=w%2?d:n}}p=pa(x);h=k-p.x-p.width/2;d=j-p.y-p.height/2;x[0][1]+=h;x[0][2]+=d;this.attr({path:x})}this.type in{text:1,image:1}&&(1!=m||1!=u)?this.transformations?(this.transformations[2]="scale(".concat(m,",",u,")"),this.node.setAttribute("transform",this.transformations[L](I)),h=-1==m?-i.x-(B||0):i.x,d=-1==u?-i.y-(C||0):
i.y,this.attr({x:h,y:d}),i.fx=m-1,i.fy=u-1):(this.node.filterMatrix=" progid:DXImageTransform.Microsoft"+".Matrix(M11=".concat(m,", M12=0, M21=0, M22=",u,", Dx=0, Dy=0, sizingmethod='auto expand', filtertype='bilinear')"),v.filter=(this.node.filterMatrix||"")+(this.node.filterOpacity||"")):this.transformations?(this.transformations[2]="",this.node.setAttribute("transform",this.transformations[L](I)),i.fx=0,i.fy=0):(this.node.filterMatrix="",v.filter=(this.node.filterMatrix||"")+(this.node.filterOpacity||
""));i.scale=[a,c,f,e][L](I);this._.sx=a;this._.sy=c}return this};w.clone=function(){if(this.removed)return null;var a=this.attr();delete a.scale;delete a.translation;return this.paper[this.type]().attr(a)};var Ea={},sa=function(a,b,c,m,h,d,i,p,k){var j=0,l=100,q=[a,b,c,m,h,d,i,p].join(),n=Ea[q],u,r;!n&&(Ea[q]=n={data:[]});n.timer&&clearTimeout(n.timer);n.timer=setTimeout(function(){delete Ea[q]},2E3);null!=k&&(l=10*~~sa(a,b,c,m,h,d,i,p));for(var t=0;t<l+1;t++){n.data[k]>t?r=n.data[t*l]:(r=e.findDotsAtSegment(a,
b,c,m,h,d,i,p,t/l),n.data[t]=r);t&&(j+=G(G(u.x-r.x,2)+G(u.y-r.y,2),0.5));if(null!=k&&j>=k)return r;u=r}if(null==k)return j},Fa=function(a,b){return function(c,m,h){for(var c=oa(c),d,i,p,k,j="",l={},q=0,n=0,r=c.length;n<r;n++){p=c[n];if("M"==p[0])d=+p[1],i=+p[2];else{k=sa(d,i,p[1],p[2],p[3],p[4],p[5],p[6]);if(q+k>m){if(b&&!l.start){d=sa(d,i,p[1],p[2],p[3],p[4],p[5],p[6],m-q);j+=["C",d.start.x,d.start.y,d.m.x,d.m.y,d.x,d.y];if(h)return j;l.start=j;j=["M",d.x,d.y+"C",d.n.x,d.n.y,d.end.x,d.end.y,p[5],
p[6]][L]();q+=k;d=+p[5];i=+p[6];continue}if(!a&&!b)return d=sa(d,i,p[1],p[2],p[3],p[4],p[5],p[6],m-q),{x:d.x,y:d.y,alpha:d.alpha}}q+=k;d=+p[5];i=+p[6]}j+=p}l.end=j;d=a?q:b?l:e.findDotsAtSegment(d,i,p[1],p[2],p[3],p[4],p[5],p[6],1);d.alpha&&(d={x:d.x,y:d.y,alpha:d.alpha});return d}},jb=Fa(1),ta=Fa(),Ga=Fa(0,1);w.getTotalLength=function(){if("path"==this.type)return this.node.getTotalLength?this.node.getTotalLength():jb(this.attrs.path)};w.getPointAtLength=function(a){if("path"==this.type)return ta(this.attrs.path,
a)};w.getSubpath=function(a,b){if("path"==this.type){if("1e-6">J(this.getTotalLength()-b))return Ga(this.attrs.path,a).end;var c=Ga(this.attrs.path,b,1);return a?Ga(c,a).end:c}};e.easing_formulas={linear:function(a){return a},"<":function(a){return G(a,3)},">":function(a){return G(a-1,3)+1},"<>":function(a){a*=2;return 1>a?G(a,3)/2:(G(a-2,3)+2)/2},backIn:function(a){return a*a*(2.70158*a-1.70158)},backOut:function(a){a-=1;return a*a*(2.70158*a+1.70158)+1},elastic:function(a){return 0==a||1==a?a:G(2,
-10*a)*B.sin(2*(a-0.075)*P/0.3)+1},bounce:function(a){var b;a<1/2.75?b=7.5625*a*a:a<2/2.75?(a-=1.5/2.75,b=7.5625*a*a+0.75):a<2.5/2.75?(a-=2.25/2.75,b=7.5625*a*a+0.9375):(a-=2.625/2.75,b=7.5625*a*a+0.984375);return b}};var V=[],kb=function(){for(var a=+new Date,b=0;b<V[t];b++){var c=V[b];if(!c.stop&&!c.el.removed){var m=a-c.start,h=c.ms,d=c.easing,i=c.from,l=c.diff,k=c.to,j=c.t,q=c.el,c={},n;if(m<h){var m=d(m/h),r;for(r in i)if(i[p](r)){switch(wa[r]){case "along":n=m*h*l[r];k.back&&(n=k.len-n);var u=
ta(k[r],n);q.translate(l.sx-l.x||0,l.sy-l.y||0);l.x=u.x;l.y=u.y;q.translate(u.x-l.sx,u.y-l.sy);k.rot&&q.rotate(l.r+u.alpha,u.x,u.y);break;case M:n=+i[r]+m*h*l[r];break;case "colour":n="rgb("+[Ha(N(i[r].r+m*h*l[r].r)),Ha(N(i[r].g+m*h*l[r].g)),Ha(N(i[r].b+m*h*l[r].b))][L](",")+")";break;case "path":n=[];for(var d=0,D=i[r][t];d<D;d++){n[d]=[i[r][d][0]];for(var v=1,w=i[r][d][t];v<w;v++)n[d][v]=+i[r][d][v]+m*h*l[r][d][v];n[d]=n[d][L](I)}n=n[L](I);break;case "csv":switch(r){case "translation":n=m*h*l[r][0]-
j.x;d=m*h*l[r][1]-j.y;j.x+=n;j.y+=d;n=n+I+d;break;case "rotation":n=+i[r][0]+m*h*l[r][0];i[r][1]&&(n+=","+i[r][1]+","+i[r][2]);break;case "scale":n=[+i[r][0]+m*h*l[r][0],+i[r][1]+m*h*l[r][1],2 in k[r]?k[r][2]:"",3 in k[r]?k[r][3]:""][L](I);break;case "clip-rect":n=[];for(d=4;d--;)n[d]=+i[r][d]+m*h*l[r][d]}break;default:D=[].concat(i[r]);n=[];for(d=q.paper.customAttributes[r].length;d--;)n[d]=+D[d]+m*h*l[r][d]}c[r]=n}q.attr(c);q._run&&q._run.call(q)}else k.along&&(u=ta(k.along,k.len*!k.back),q.translate(l.sx-
(l.x||0)+u.x-l.sx,l.sy-(l.y||0)+u.y-l.sy),k.rot&&q.rotate(l.r+u.alpha,u.x,u.y)),(j.x||j.y)&&q.translate(-j.x,-j.y),k.scale&&(k.scale+=""),q.attr(k),V.splice(b--,1)}}e.svg&&q&&q.paper&&q.paper.safari();V[t]&&setTimeout(kb)},Gb=function(a,b,c,m,h){var d=c-m;b.timeouts.push(setTimeout(function(){e.is(h,"function")&&h.call(b);b.animate(a,d,a.easing)},m))},Ha=function(a){return Q(W(a,255),0)},ra=function(a,c){if(null==a)return{x:this._.tx,y:this._.ty,toString:b};this._.tx+=+a;this._.ty+=+c;switch(this.type){case "circle":case "ellipse":this.attr({cx:+a+
this.attrs.cx,cy:+c+this.attrs.cy});break;case "rect":case "image":case "text":this.attr({x:+a+this.attrs.x,y:+c+this.attrs.y});break;case "path":var f=za(this.attrs.path);f[0][1]+=+a;f[0][2]+=+c;this.attr({path:f})}return this};w.animateWith=function(a,b,c,e,h){for(var d=0,m=V.length;d<m;d++)V[d].el.id==a.id&&(b.start=V[d].start);return this.animate(b,c,e,h)};w.animateAlong=a();w.animateAlongBack=a(1);w.onAnimation=function(a){this._run=a||0;return this};w.animate=function(a,b,c,m){var h=this;h.timeouts=
h.timeouts||[];if(e.is(c,"function")||!c)m=c||null;if(h.removed)return m&&m.call(h),h;var d={},i={},l=!1,k={},j;for(j in a)if(a[p](j)&&(wa[p](j)||h.paper.customAttributes[p](j)))switch(l=!0,d[j]=h.attr(j),null==d[j]&&(d[j]=ka[j]),i[j]=a[j],wa[j]){case "along":var q=jb(a[j]),n=ta(a[j],q*!!a.back),r=h.getBBox();k[j]=q/b;k.tx=r.x;k.ty=r.y;k.sx=n.x;k.sy=n.y;i.rot=a.rot;i.back=a.back;i.len=q;a.rot&&(k.r=x(h.rotate())||0);break;case M:k[j]=(i[j]-d[j])/b;break;case "colour":d[j]=e.getRGB(d[j]);q=e.getRGB(i[j]);
k[j]={r:(q.r-d[j].r)/b,g:(q.g-d[j].g)/b,b:(q.b-d[j].b)/b};break;case "path":q=oa(d[j],i[j]);d[j]=q[0];r=q[1];k[j]=[];q=0;for(n=d[j][t];q<n;q++){k[j][q]=[0];for(var D=1,v=d[j][q][t];D<v;D++)k[j][q][D]=(r[q][D]-d[j][q][D])/b}break;case "csv":n=C(a[j]).split(u);r=C(d[j]).split(u);switch(j){case "translation":d[j]=[0,0];k[j]=[n[0]/b,n[1]/b];break;case "rotation":d[j]=r[1]==n[1]&&r[2]==n[2]?r:[0,n[1],n[2]];k[j]=[(n[0]-d[j][0])/b,0,0];break;case "scale":a[j]=n;d[j]=C(d[j]).split(u);k[j]=[(n[0]-d[j][0])/
b,(n[1]-d[j][1])/b,0,0];break;case "clip-rect":d[j]=C(d[j]).split(u);k[j]=[];for(q=4;q--;)k[j][q]=(n[q]-d[j][q])/b}i[j]=n;break;default:n=[].concat(a[j]);r=[].concat(d[j]);k[j]=[];for(q=h.paper.customAttributes[j][t];q--;)k[j][q]=((n[q]||0)-(r[q]||0))/b}if(l){j=e.easing_formulas[c];if(!j)if((j=C(c).match(pb))&&5==j[t]){var w=j;j=function(a){var c=+w[1],f=+w[2],g=3*c,d=3*(+w[3]-c)-g,e=1-g-d,c=3*f,f=3*(+w[4]-f)-c,h=1-c-f,a=function(a,b){var c,f,h,m;h=a;for(f=0;8>f;f++){m=((e*h+d)*h+g)*h-a;if(J(m)<b)return h;
c=(3*e*h+2*d)*h+g;if(1E-6>J(c))break;h-=m/c}c=0;f=1;h=a;if(h<c)return c;if(h>f)return f;for(;c<f;){m=((e*h+d)*h+g)*h;if(J(m-a)<b)break;a>m?c=h:f=h;h=(f-c)/2+c}return h}(a,1/(200*b));return((h*a+f)*a+c)*a}}else j=function(a){return a};V.push({start:a.start||+new Date,ms:b,easing:j,from:d,diff:k,to:i,el:h,t:{x:0,y:0}});e.is(m,"function")&&(h._ac=setTimeout(function(){m.call(h)},b));1==V[t]&&setTimeout(kb)}else{var c=[],B,y;for(y in a)a[p](y)&&qb.test(y)&&(j={value:a[y]},"from"==y&&(y=0),"to"==y&&(y=
100),j.key=Y(y,10),c.push(j));c.sort(vb);c[0].key&&c.unshift({key:0,value:h.attrs});q=0;for(n=c[t];q<n;q++)Gb(c[q].value,h,b/100*c[q].key,b/100*(c[q-1]&&c[q-1].key||0),c[q-1]&&c[q-1].value.callback);(B=c[c[t]-1].value.callback)&&h.timeouts.push(setTimeout(function(){B.call(h)},b))}return this};w.stop=function(){for(var a=0;a<V.length;a++)V[a].el.id==this.id&&V.splice(a--,1);a=0;for(ii=this.timeouts&&this.timeouts.length;a<ii;a++)clearTimeout(this.timeouts[a]);this.timeouts=[];clearTimeout(this._ac);
delete this._ac;return this};w.translate=function(a,b){return this.attr({translation:a+" "+b})};w[X]=function(){return"Rapha\u00ebl\u2019s object"};e.ae=V;var T=function(a){this.items=[];this[t]=0;this.type="set";if(a)for(var b=0,c=a[t];b<c;b++)a[b]&&(a[b].constructor==E||a[b].constructor==T)&&(this[this.items[t]]=this.items[this.items[t]]=a[b],this[t]++)};T[m][F]=function(){for(var a,b,c=0,e=arguments[t];c<e;c++)(a=arguments[c])&&(a.constructor==E||a.constructor==T)&&(b=this.items[t],this[b]=this.items[b]=
a,this[t]++);return this};T[m].pop=function(){delete this[this[t]--];return this.items.pop()};for(var Ia in w)w[p](Ia)&&(T[m][Ia]=function(a){return function(){for(var b=0,c=this.items[t];b<c;b++)this.items[b][a][H](this.items[b],arguments);return this}}(Ia));T[m].attr=function(a,b){if(a&&e.is(a,R)&&e.is(a[0],"object"))for(var c=0,m=a[t];c<m;c++)this.items[c].attr(a[c]);else{c=0;for(m=this.items[t];c<m;c++)this.items[c].attr(a,b)}return this};T[m].animate=function(a,b,c,m){(e.is(c,"function")||!c)&&
(m=c||null);var h=this.items[t],d=h,i,q=this,k;m&&(k=function(){!--h&&m.call(q)});c=e.is(c,"string")?c:k;for(i=this.items[--d].animate(a,b,c,k);d--;)this.items[d]&&!this.items[d].removed&&this.items[d].animateWith(i,a,b,c,k);return this};T[m].insertAfter=function(a){for(var b=this.items[t];b--;)this.items[b].insertAfter(a);return this};T[m].getBBox=function(){for(var a=[],b=[],c=[],e=[],h=this.items[t];h--;){var d=this.items[h].getBBox();a[F](d.x);b[F](d.y);c[F](d.x+d.width);e[F](d.y+d.height)}a=
W[H](0,a);b=W[H](0,b);return{x:a,y:b,width:Q[H](0,c)-a,height:Q[H](0,e)-b}};T[m].clone=function(a){for(var a=new T,b=0,c=this.items[t];b<c;b++)a[F](this.items[b].clone());return a};e.registerFont=function(a){if(!a.face)return a;this.fonts=this.fonts||{};var b={w:a.w,face:{},glyphs:{}},c=a.face["font-family"],e;for(e in a.face)a.face[p](e)&&(b.face[e]=a.face[e]);this.fonts[c]?this.fonts[c][F](b):this.fonts[c]=[b];if(!a.svg){b.face["units-per-em"]=Y(a.face["units-per-em"],10);for(var h in a.glyphs)if(a.glyphs[p](h)&&
(c=a.glyphs[h],b.glyphs[h]={w:c.w,k:{},d:c.d&&"M"+c.d.replace(/[mlcxtrv]/g,function(a){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[a]||"M"})+"z"},c.k))for(var d in c.k)c[p](d)&&(b.glyphs[h].k[d]=c.k[d])}return a};y.getFont=function(a,b,c,m){m=m||"normal";c=c||"normal";b=+b||{normal:400,bold:700,lighter:300,bolder:800}[b]||400;if(e.fonts){var h=e.fonts[a];if(!h){var a=RegExp("(^|\\s)"+a.replace(/[^\w\d\s+!~.:_-]/g,"")+"(\\s|$)","i"),d;for(d in e.fonts)if(e.fonts[p](d)&&a.test(d)){h=e.fonts[d];break}}var i;
if(h){d=0;for(a=h[t];d<a&&!(i=h[d],i.face["font-weight"]==b&&(i.face["font-style"]==c||!i.face["font-style"])&&i.face["font-stretch"]==m);d++);}return i}};y.print=function(a,b,c,m,h,d,i){var d=d||"middle",i=Q(W(i||0,1),-1),q=this.set(),k=C(c).split(""),j=0;e.is(m,c)&&(m=this.getFont(m));if(m){for(var c=(h||16)/m.face["units-per-em"],p=m.face.bbox.split(u),h=+p[0],d=+p[1]+("baseline"==d?p[3]-p[1]+ +m.face.descent:(p[3]-p[1])/2),p=0,l=k[t];p<l;p++){var n=p&&m.glyphs[k[p-1]]||{},r=m.glyphs[k[p]],j=j+
(p?(n.w||m.w)+(n.k&&n.k[k[p]]||0)+m.w*i:0);r&&r.d&&q[F](this.path(r.d).attr({fill:"#000",stroke:"none",translation:[j,0]}))}q.scale(c,c,h,d).translate(a-h,b-d)}return q};e.format=function(a,b){var c=e.is(b,R)?[0].concat(b):arguments;a&&e.is(a,"string")&&c[t]-1&&(a=a.replace(n,function(a,b){return null==c[++b]?"":c[b]}));return a||""};e.ninja=function(){Ja?D.Raphael=lb:delete Raphael;return e};e.el=w;e.st=T[m];Ja?D.Raphael=e:Raphael=e})();function CockpitUI(){this._frontRadarPaper=this._rearRadarElem=this._frontRadarElem=null;this._frontBlipElemMap={};this._rearRadarPaper=null;this._rearBlipElemMap={};this._hpBar=this._hpBarBorder=this.HoopForBlip=null;this._hpRemaining=1;this._owningShip=null}CockpitUI.FrontRadarRadius=99;CockpitUI.RadarRange=2E3;CockpitUI.RadarRangeSq=CockpitUI.RadarRange*CockpitUI.RadarRange;CockpitUI.BlipElemNamePrefix="RadarBlip_Ship";CockpitUI.HoopBlipId="HoopBlip";
CockpitUI.prototype={InitFromDOM:function(){this._frontRadarElem=$(".front-radar")[0];this._rearRadarElem=$(".rear-radar")[0];CockpitUI.FrontRadarRadius=this._frontRadarElem.clientWidth/2;CockpitUI.RearRadarRadius=this._rearRadarElem.clientWidth/2;this._frontRadarPaper=Raphael(this._frontRadarElem,this._frontRadarElem.clientWidth,this._frontRadarElem.clientHeight);this._rearRadarPaper=Raphael(this._rearRadarElem,this._rearRadarElem.clientWidth,this._rearRadarElem.clientHeight);this._hpBarBorder=document.getElementById("HPBar");
this._hpBar=document.createElement("div");this._hpBar.className="HPBar";this._hpBarBorder.appendChild(this._hpBar);var a=document.createElement("div");a.className="UILabel";a.innerHTML="Shields";a.style.bottom="-22px";a.style.left="-15px";this._hpBarBorder.appendChild(a)},Term:function(){for(var a=[this._frontRadarElem,this._rearRadarElem,this._hpBarBorder],b=0;b<a.length;++b)Util.RemoveAllChildren(a[b])},HookUpToShip:function(a){this._owningShip=a},Update:function(){if(null!=this._owningShip){this.HoopForBlip&&
this.UpdateBlipRadarPosition(this.HoopForBlip.Position,CockpitUI.HoopBlipId);for(var a=XhtmlWingGame.MainGame._ships,b=0;b<a.length;++b){var c=a[b];c!=this._owningShip&&this.UpdateBlipRadarPosition(c.Position,CockpitUI.BlipElemNamePrefix+c.UniqueId)}this._owningShip.HullHP/this._owningShip.HullMaxHP!=this._hpRemaining&&(this._hpRemaining=this._owningShip.HullHP/this._owningShip.HullMaxHP,this._hpBar.style.height=100*this._hpRemaining+"%",$("#front-shield-gauge").css("height",100*this._hpRemaining+
"%"))}},UpdateBlipRadarPosition:function(a,b){var c=new THREE.Vector3;c.subVectors(a,this._owningShip.Position);if(c.lengthSq()>CockpitUI.RadarRangeSq)this.HideBlip(b);else{var l=0<c.dot(this._owningShip.Forward),e=this.GetOrCreateRadarBlip(b,l),u=(CockpitUI.RadarRangeSq-c.lengthSq())/CockpitUI.RadarRangeSq;e.attr("r",5*u+2);c.normalize();Util.ProjectVectorOntoPlane(c,this._owningShip.Forward);c=new THREE.Vector2(c.dot(this._owningShip.Right)/-this._owningShip.Right.lengthSq(),c.dot(this._owningShip.Up)/
this._owningShip.Up.lengthSq());1<c.lengthSq()&&c.normalize();l?(c.multiplyScalar(-CockpitUI.FrontRadarRadius),e.attr("cx",c.x+this._frontRadarElem.clientWidth/2),e.attr("cy",c.y+this._frontRadarElem.clientHeight/2)):(c.multiplyScalar(-CockpitUI.RearRadarRadius),e.attr("cx",c.x+this._rearRadarElem.clientWidth/2),e.attr("cy",c.y+this._rearRadarElem.clientHeight/2))}},OnShipRemoveFromSim:function(a){a=CockpitUI.BlipElemNamePrefix+a;null!=this._frontBlipElemMap[a]&&(this._frontBlipElemMap[a].hide(),
this._rearBlipElemMap[a].hide())},HideBlip:function(a){null!=this._frontBlipElemMap[a]&&(this._frontBlipElemMap[a].remove(),this._frontBlipElemMap[a]=null,this._rearBlipElemMap[a].remove(),this._rearBlipElemMap[a]=null)},GetOrCreateRadarBlip:function(a,b){if(null==this._frontBlipElemMap[a]){var c;if(a==CockpitUI.HoopBlipId)c=Hoop.Color_NextStr;else if(0===a.indexOf(CockpitUI.BlipElemNamePrefix)){var l=parseInt(a.substr(CockpitUI.BlipElemNamePrefix.length));(l=XhtmlWingGame.MainGame.GetShipById(l))&&
l.IsGoodGuy&&(c="#20F02A")}this.CreateBlipElem(a,c||"red")}c=this._frontBlipElemMap[a];var l=this._rearBlipElemMap[a],e;b?(e=c,l.hide()):(e=l,c.hide());e.show();return e},CreateBlipElem:function(a,b){var c=this._frontRadarPaper.circle(0,0,5);c.attr("fill",b);this._frontBlipElemMap[a]=c;c=this._rearRadarPaper.circle(0,0,5);c.attr("fill",b);this._rearBlipElemMap[a]=c}};function AIShipController(a){this.Ship=a;this.Target=null;this.CurrentState=AIShipController.STATE_Random;this._evadeRandomTime=this._elapsedTime=0;this.Skill=0.25;this._toTarget=new THREE.Vector3}AIShipController.STATE_Engage=0;AIShipController.STATE_Evade=1;AIShipController.STATE_Random=2;AIShipController.STATE_Formation=3;AIShipController.EngageMinDist=120;AIShipController.EngageMinDistSq=AIShipController.EngageMinDist*AIShipController.EngageMinDist;AIShipController.EvadeMaxDist=450;
AIShipController.EvadeMaxDistSq=AIShipController.EvadeMaxDist*AIShipController.EvadeMaxDist;AIShipController.GetRandomNormalizedVector3=function(){var a=new THREE.Vector3;a.x=2*Math.random()-1;a.y=2*Math.random()-1;a.z=2*Math.random()-1;0==a.lengthSq()?a.x=1:a.normalize();return a};
AIShipController.prototype={Update:function(a){this._elapsedTime+=a;null!=this.Target&&this._toTarget.subVectors(this.Target.Position,this.Ship.Position);switch(this.CurrentState){case AIShipController.STATE_Engage:null!=this.Target&&(this._toTarget.lengthSq()<AIShipController.EngageMinDistSq?(this.CurrentState=AIShipController.STATE_Evade,this.Ship.IsTriggerPulled=!1):(this.Ship.IsTriggerPulled=0.375<this._toTarget.dot(this.Ship.Forward),a=this.Target.Position.clone(),a.add(this.Target.Forward.clone().multiplyScalar(-this.Target.BoundingRadius+
1.1*this.Skill*this.Target.BoundingRadius)),this._toTarget.subVectors(a,this.Ship.Position),this.Ship.TargetHeading=this._toTarget));break;case AIShipController.STATE_Evade:null!=this.Target&&(this._toTarget.lengthSq()>AIShipController.EvadeMaxDistSq?this.CurrentState=AIShipController.STATE_Engage:(this._toTarget.multiplyScalar(-1),this.Ship.TargetHeading=this._toTarget,this._evadeRandomTime=2*Math.random(),this._elapsedTime=0));break;case AIShipController.STATE_Random:2<this._elapsedTime&&(this._elapsedTime=
0,this.Ship.TargetHeading=AIShipController.GetRandomNormalizedVector3())}}};function ShipWeapon(a,b){this.OwningShip=a;this.MuzzleOffset=b;this.EnergyLevel=1};function Spaceship(a,b){this.Position=new THREE.Vector3;this.Forward=new THREE.Vector3(0,0,-1);this.Up=new THREE.Vector3(0,1,0);this.Right=new THREE.Vector3;this.Right.crossVectors(this.Forward,this.Up);this.RateOfFire=0.4;this._fireTimer=0;this.BoundingRadius=25;this.BoundingRadiusSq=this.BoundingRadius*this.BoundingRadius;this.isPlayersShip=a;this.HullMaxHP=100;a&&(this.HullMaxHP=200);this.HullHP=this.HullMaxHP;a&&(this.RearArmorHP=this.FrontArmorHP=this.RearShieldHP=this.FrontShieldHP=this.HullMaxHP,
$(".front-shield-gauge").css("height","100%"),$(".rear-shield-gauge").css("height","100%"),$(".front-armor-gauge").css("height","100%"),$(".rear-armor-gauge").css("height","100%"));this.IsTriggerPulled=this.IsGoodGuy=!1;this.TargetHeading=null;this.EnginePowerScalar=0.5;this.EnginePowerNumerator=4;this.LaserPowerScalar=0.5;this.LaserPowerNumerator=2;this.ShieldPowerScalar=0.5;this.ShieldPowerNumerator=2;this.EngineSpeed_FullOutput=150;this.EngineSpeed_ZeroOuput=75;this.EngineSpeed_OutputScalar=this.EngineSpeed_FullOutput-
this.EngineSpeed_ZeroOuput;this.Throttle=1;this.Speed=this.TargetSpeed=0;this.AccelerationRate=25;this.AdjustEngineOutput("");this.Speed=this.TargetSpeed;$("#SpeedLabel").text(Math.round(this.Speed));this.TurnSpeed=0.4*Math.PI;this.ShipType=Spaceship.ShipTypes[b]||Spaceship.ShipTypes.Normal;this.PitchYawRollSpeed=new THREE.Vector3;this.PreviousPosition=this.Position.clone();this.Mesh=null;!a&&XhtmlWingGame.MainGame._loadedGeometries.Normal&&this.UpdateFromGeometry("Normal",XhtmlWingGame.MainGame._loadedGeometries.Normal,
!1);this.Weapons=[];XhtmlWingGame.MainGame._isStarWarsGame&&this.ShipType===Spaceship.ShipTypes.XWing?(this.Weapons.push(new ShipWeapon(this,new THREE.Vector3(-23,-5,0))),this.Weapons.push(new ShipWeapon(this,new THREE.Vector3(23,-5,0))),this.Weapons.push(new ShipWeapon(this,new THREE.Vector3(23,5,0))),this.Weapons.push(new ShipWeapon(this,new THREE.Vector3(-23,5,0)))):(this.Weapons.push(new ShipWeapon(this,new THREE.Vector3(-5,-5,0))),this.Weapons.push(new ShipWeapon(this,new THREE.Vector3(5,-5,
0))));this.UniqueId=Spaceship.NextUniqueId++;this.NextWeaponToUse=0}Spaceship.ShipTypes={Normal:{value:0,name:"Normal"},XWing:{value:1,name:"XWing"},Tie:{value:2,name:"Tie"},VadersTie:{value:3,name:"VadersTie"}};Spaceship.NextUniqueId=1;Spaceship.EngineBarTop=18.5;Spaceship.EngineBarHeight=20.5;
Spaceship.prototype={Update:function(a){this.ClampPYRSpeedVector();if(this.TargetHeading){var b=new THREE.Vector3;b.crossVectors(this.Forward,this.TargetHeading);0.001>b.lengthSq()?b=this.Right:b.normalize();var c=new THREE.Matrix4;c.makeRotationAxis(b,this.TurnSpeed*a);this.Up.applyMatrix4(c);this.Forward.applyMatrix4(c)}else{b=new THREE.Matrix4;b.makeRotationAxis(this.Forward,this.PitchYawRollSpeed.z*this.TurnSpeed*a);c=new THREE.Matrix4;c.makeRotationAxis(this.Up,this.PitchYawRollSpeed.y*this.TurnSpeed*
a);var l=new THREE.Matrix4;l.makeRotationAxis(this.Right,this.PitchYawRollSpeed.x*this.TurnSpeed*a);l.multiply(b);l.multiply(c);this.Up.applyMatrix4(l);this.Forward.applyMatrix4(l)}this.Right.crossVectors(this.Forward,this.Up);this.Right.normalize();this.Speed!=this.TargetSpeed&&(b=this.TargetSpeed-this.Speed,c=this.AccelerationRate*a,this.Speed=c>Math.abs(b)?this.TargetSpeed:this.Speed+c*(0>b?-1:1),this.isPlayersShip&&($("#SpeedLabel").text(Math.round(this.Speed)),$(".speed").text(Math.round(this.Speed))));
b=0.1*this.LaserPowerScalar*a;for(c=0;c<this.Weapons.length;++c){var e=this.Weapons[c];1<=e.EnergyLevel||(e.EnergyLevel+=b,1<e.EnergyLevel&&(e.EnergyLevel=1),this===XhtmlWingGame.MainGame._playerShip&&(0==c?(l=$(".right-laser-gauge"),l.css({width:Math.floor(100*e.EnergyLevel)+"%"})):(l=$(".left-laser-gauge"),e=Math.floor(100*(1-e.EnergyLevel)),l.css({left:e+"%"}),l.width(100-e+"%"))))}this.isPlayersShip&&(b=10*this.ShieldPowerScalar*a,this.FrontShieldHP<this.HullMaxHP&&(this.FrontShieldHP+=b,this.FrontShieldHP>
this.HullMaxHP&&(this.FrontShieldHP=this.HullMaxHP),c=this.FrontShieldHP/this.HullMaxHP,$(".front-shield-gauge").css("height",Math.floor(100*c)+"%")),this.RearShieldHP<this.HullMaxHP&&(this.RearShieldHP+=b,this.RearShieldHP>this.HullMaxHP&&(this.RearShieldHP=this.HullMaxHP),c=this.RearShieldHP/this.HullMaxHP,$(".rear-shield-gauge").css("height",Math.floor(100*c)+"%")));b=this.Forward.clone();b.multiplyScalar(this.Speed*a);this.PreviousPosition=this.Position.clone();this.Position.add(b);this.Mesh&&
(this.Mesh.position=this.Position,this.Mesh.rotation=this.GetOrientationEuler());this.BoundingSphereMesh&&(this.BoundingSphereMesh.position=this.Position);this._fireTimer-=a;this.IsTriggerPulled&&0>this._fireTimer&&this.FireNextWeapon()},FireNextWeapon:function(){var a=XhtmlWingGame.MainGame,b=this.Weapons[this.NextWeaponToUse];0.125>b.EnergyLevel||(a._lasers.push(new Laser(this)),this===a._playerShip&&Main.CurPlayerInfo.Setting_PlaySounds&&(b===this.Weapons[0]?(a._laserSound.play(),b.EnergyLevel-=
0.125,a=$(".right-laser-gauge"),a.css({width:Math.floor(100*b.EnergyLevel)+"%"})):(a._laserSound2.play(),b.EnergyLevel-=0.125,a=$(".left-laser-gauge"),b=Math.floor(100*(1-b.EnergyLevel)),a.css({left:b+"%"}),a.width(100-b+"%"))),this._fireTimer=this.RateOfFire)},UpdateFromGeometry:function(){if(!this.Mesh&&XhtmlWingGame.MainGame._loadedGeometries[this.ShipType.name]){var a;a=XhtmlWingGame.MainGame._isStarWarsGame?new THREE.MeshFaceMaterial:new THREE.MeshLambertMaterial({map:THREE.ImageUtils.loadTexture("models/Sfighter_03_CLR.png"),
wireframe:!1});this.Mesh=new THREE.Mesh(XhtmlWingGame.MainGame._loadedGeometries[this.ShipType.name],a);XhtmlWingGame.MainGame._scene.add(this.Mesh)}},AdjustShield:function(a){var b=$("#ShieldSwitch");switch(a){case "F":b.css({top:"71.5%"});break;case "M":b.css({top:"76.7%"});break;case "R":b.css({top:"81.5%"})}},AdjustThrottle:function(){this.Throttle-=0.25;0>this.Throttle&&(this.Throttle=1);this.isPlayersShip&&($("#ThrottleBar").width(22*this.Throttle+"%"),$(".throttle").animate({height:Math.floor(100*
this.Throttle)+"%"},XhtmlWingGame.AnimationDuration));this.UpdateTargetSpeed()},AdjustEngineOutput:function(a){switch(a){case "E":6>=this.EnginePowerNumerator?(this.EnginePowerNumerator+=2,0<this.LaserPowerNumerator&&0<this.ShieldPowerNumerator?(--this.LaserPowerNumerator,--this.ShieldPowerNumerator):1<this.LaserPowerNumerator?this.LaserPowerNumerator-=2:this.ShieldPowerNumerator-=2):(this.EnginePowerNumerator=0,this.ShieldPowerNumerator=this.LaserPowerNumerator=4);break;case "L":3>=this.LaserPowerNumerator?
(++this.LaserPowerNumerator,--this.EnginePowerNumerator):(this.LaserPowerNumerator=0,this.EnginePowerNumerator+=4);break;case "S":3>=this.ShieldPowerNumerator?(++this.ShieldPowerNumerator,--this.EnginePowerNumerator):(this.ShieldPowerNumerator=0,this.EnginePowerNumerator+=4)}this.EnginePowerScalar=this.EnginePowerNumerator/8;this.LaserPowerScalar=this.LaserPowerNumerator/4;this.ShieldPowerScalar=this.ShieldPowerNumerator/4;var a=Spaceship.EngineBarHeight*this.EnginePowerScalar,b=Spaceship.EngineBarHeight*
this.LaserPowerScalar,c=Spaceship.EngineBarHeight*this.ShieldPowerScalar;$("#EngineBar").css("top",Spaceship.EngineBarTop+Spaceship.EngineBarHeight-a+"%");$("#LaserBar").css("top",Spaceship.EngineBarTop+Spaceship.EngineBarHeight-b+"%");$("#ShieldBar").css("top",Spaceship.EngineBarTop+Spaceship.EngineBarHeight-c+"%");$("#EngineBar").height(a+"%");$("#LaserBar").height(b+"%");$("#ShieldBar").height(c+"%");$(".engine-output-full").animate({height:Math.floor(100*this.EnginePowerScalar)+"%"},XhtmlWingGame.AnimationDuration);
$(".laser-output-full").animate({height:Math.floor(100*this.LaserPowerScalar)+"%"},XhtmlWingGame.AnimationDuration);$(".shield-output-full").animate({height:Math.floor(100*this.ShieldPowerScalar)+"%"},XhtmlWingGame.AnimationDuration);this.UpdateTargetSpeed()},UpdateTargetSpeed:function(){this.TargetSpeed=this.Throttle*(this.EngineSpeed_OutputScalar*this.EnginePowerScalar+this.EngineSpeed_ZeroOuput)},HandleLaserHit:function(a){this.isPlayersShip?0<a.Mesh.position.clone().sub(this.Position).dot(this.Forward)?
(this.FrontShieldHP-=a.Damage,0>this.FrontShieldHP&&(this.FrontArmorHP-=-this.FrontShieldHP,this.FrontShieldHP=0,a=this.FrontArmorHP/this.HullMaxHP,$(".front-armor-gauge").css("height",Math.floor(100*a)+"%"),0>=this.FrontArmorHP&&(this.HullHP=-1)),a=this.FrontShieldHP/this.HullMaxHP,$(".front-shield-gauge").css("height",Math.floor(100*a)+"%")):(this.RearShieldHP-=a.Damage,0>this.RearShieldHP&&(this.RearArmorHP-=-this.RearShieldHP,this.RearShieldHP=0,a=this.RearArmorHP/this.HullMaxHP,$(".rear-armor-gauge").css("height",
Math.floor(100*a)+"%"),0>=this.RearArmorHP&&(this.HullHP=-1)),a=this.RearShieldHP/this.HullMaxHP,$(".rear-shield-gauge").css("height",Math.floor(100*a)+"%")):this.HullHP-=a.Damage},ClampPYRSpeedVector:function(){-1>this.PitchYawRollSpeed.x?this.PitchYawRollSpeed.x=-1:1<this.PitchYawRollSpeed.x&&(this.PitchYawRollSpeed.x=1);-1>this.PitchYawRollSpeed.y?this.PitchYawRollSpeed.y=-1:1<this.PitchYawRollSpeed.y&&(this.PitchYawRollSpeed.y=1);-1>this.PitchYawRollSpeed.z?this.PitchYawRollSpeed.z=-1:1<this.PitchYawRollSpeed.z&&
(this.PitchYawRollSpeed.z=1)},GetTransform:function(){var a=new THREE.Matrix4;a.n11=this.Right.x;a.n21=this.Right.y;a.n31=this.Right.z;a.n12=this.Up.x;a.n22=this.Up.y;a.n32=this.Up.z;a.n13=this.Forward.x;a.n23=this.Forward.y;a.n33=this.Forward.z;a.n14=this.Position.x;a.n24=this.Position.y;a.n34=this.Position.z;a.elements[0]=8E-4*this.Right.x;a.elements[1]=8E-4*this.Right.y;a.elements[2]=8E-4*this.Right.z;a.elements[4]=8E-4*this.Up.x;a.elements[5]=8E-4*this.Up.y;a.elements[6]=8E-4*this.Up.z;a.elements[8]=
8E-4*this.Forward.x;a.elements[9]=8E-4*this.Forward.y;a.elements[10]=8E-4*this.Forward.z;a.elements[12]=this.Position.x;a.elements[13]=this.Position.y;a.elements[14]=this.Position.z;return a},GetOrientationMatrix:function(){return Util.MakeOrientationMatrix(this.Up,this.Forward,this.Right)},GetOrientationEuler:function(){var a=this.GetOrientationMatrix(),b=new THREE.Euler;b.setFromRotationMatrix(a);return b},GetOrientationQuat:function(){var a=this.GetOrientationMatrix(),b=new THREE.Quaternion;a.decompose(null,
b,null);b.setFromRotationMatrix(a);return b},SetCameraForShip:function(a){a.position=this.Position.clone();a.lookAt(this.Position.clone().add(this.Forward));a.up=this.Up.clone()}};function Hoop(a,b){this.Position=a?a:new THREE.Vector3;this.Forward=b?b:new THREE.Vector3(0,0,1);this.BoundRadius=100;this.BoundRadiusSq=this.BoundRadius*this.BoundRadius;this.Mesh=new THREE.Mesh(new THREE.TorusGeometry(this.BoundRadius,20,8,32),Hoop.Material_Incomplete);var c=Util.GetRandomOrthVector(this.Forward);this.Mesh.position=this.Position;this.Mesh.rotation.setFromRotationMatrix(Util.MakeOrientationMatrix(c,this.Forward));this.HasBeenPassedThrough=!1}Hoop.Color_Next=2158634;
Hoop.Color_NextStr="#20F02A";Hoop.Material_Next=new THREE.MeshBasicMaterial({color:2158634,ambient:2158634,wireframe:!1});Hoop.Material_Incomplete=new THREE.MeshLambertMaterial({color:5592405,ambient:5592405,wireframe:!1});Hoop.Color_Complete=1935854;Hoop.Material_Complete=new THREE.MeshBasicMaterial({color:1935854,wireframe:!1});
Hoop.prototype={UpdatePassedThrough:function(a,b){var c=b.clone().sub(this.Position);return c.lengthSq()>this.BoundRadiusSq?!1:0>a.clone().sub(this.Position).dot(this.Forward)*c.dot(this.Forward)?(this.Mesh.material=Hoop.Material_Complete,this.HasBeenPassedThrough=!0):!1}};function HoopList(){this.hoops=[];this.activeHoopIndex=0;this.onComplete=null}
HoopList.prototype={initAlongSpline:function(a,b,c){a=HoopList.makeHoopsAlongSpline(a,b);this.init(a,c)},initAlongRay:function(a,b,c,l){a=HoopList.makeHoopsAlongRay(a,b,c);this.init(a,l)},init:function(a,b){this.hoops=a;this.onComplete=b;for(var c=XhtmlWingGame.MainGame._scene,l=0;l<this.hoops.length;++l)c.add(this.hoops[l].Mesh);this.activeHoopIndex=0;this.hoops[0].Mesh.material=Hoop.Material_Next},updatePassThrough:function(a,b){if(!(0===this.hoops.length||this.activeHoopIndex>=this.hoops.length)&&
this.hoops[this.activeHoopIndex].UpdatePassedThrough(a,b))if(Main.CurPlayerInfo.Setting_PlaySounds&&HoopList.hoopClearedSound&&HoopList.hoopClearedSound.play(),++this.activeHoopIndex,this.activeHoopIndex>=this.hoops.length){if(this.onComplete)this.onComplete()}else this.hoops[this.activeHoopIndex].Mesh.material=Hoop.Material_Next,XhtmlWingGame.MainGame._cockpitUI.HoopForBlip=this.hoops[this.activeHoopIndex]},remove:function(){for(var a=XhtmlWingGame.MainGame._scene,b=0;b<this.hoops.length;++b)a.remove(this.hoops[b].Mesh);
this.hoops=[];this.activeHoopIndex=0}};HoopList.hoopClearedSound=null;HoopList.makeHoopsAlongSpline=function(a,b){for(var c=0.95/(b-1),l=[],e=0;1>e;e+=c){var u=a.getPoint(e),u=new THREE.Vector3(u.x,u.y,u.z),r=new THREE.Vector3;r.subVectors(a.getPoint(e+0.02),u);r.normalize();l.push(new Hoop(u,r))}return l};HoopList.makeHoopsAlongRay=function(a,b,c){var c=0.95/(c-1),l=[],e=b.clone();e.normalize();for(var u=0;1>u;u+=c){var r=b.clone();r.multiplyScalar(u);r.add(a);l.push(new Hoop(r,e))}return l};function MissionShip(a,b,c){this.Position=a;this.ShipTypeName=b||"Normal";this.IsGoodGuy=c||!1}function Mission(){this.Description=this.Title="";this.MissionShips=[];this.HoopSpline=null;this.NumHoops=0}
Mission.MakeStarWars=function(){var a=new Mission;a.Title="XHTML-Wing vs. Tie Fighter";a.Description="Battle Darth Vader and his escorts<br />Thanks to <a href='http://www.blendswap.com/blends/author/benjob/' target='_blank'>BenJob</a> for the models.";a.MissionShips.push(new MissionShip(new THREE.Vector3(-100,0,-600),"Tie"));a.MissionShips.push(new MissionShip(new THREE.Vector3(-50,0,-550),"Tie"));a.MissionShips.push(new MissionShip(new THREE.Vector3(0,0,-500),"VadersTie"));a.MissionShips.push(new MissionShip(new THREE.Vector3(50,
0,-550),"Tie"));a.MissionShips.push(new MissionShip(new THREE.Vector3(100,0,-600),"Tie"));a.MissionShips.push(new MissionShip(new THREE.Vector3(50,0,50),"XWing",!0));a.MissionShips.push(new MissionShip(new THREE.Vector3(100,0,0),"XWing",!0));return a};
Mission.MakeSkirmish=function(a){1>a&&(a=1);var b=new Mission;b.Title="Combat Drone Skirmish";b.Description=1==a?"Destroy the combat drone.":"Destroy the "+a+" combat drones.";for(var c=0;c<a;++c)b.MissionShips.push(new MissionShip(Util.GetRandomPointInSphere(2E3)));return b};Mission.MakeArena=function(){return Mission.MakeSkirmish(5)};Mission.Missions=[];Mission.Missions.push(new Mission);Mission.Missions.push(new Mission);Mission.Missions.push(new Mission);Mission.Missions[0].Title="Basic Pilot Skills";
Mission.Missions[0].Description="Fly through the hoops, in order. The green hoop indicates the next hoop to pass through and can be found on your radar as a green blip.";var ZOffset=-50,ZScale=-450;Mission.Missions[0].HoopSpline=new THREE.Spline([new THREE.Vector3(0,0,ZOffset+1*ZScale),new THREE.Vector3(0,0,ZOffset+3*ZScale),new THREE.Vector3(-100,150,ZOffset+4*ZScale),new THREE.Vector3(-150,250,ZOffset+5*ZScale),new THREE.Vector3(200,0,ZOffset+6*ZScale),new THREE.Vector3(400,-250,ZOffset+7*ZScale)]);
Mission.Missions[0].NumHoops=12;Mission.Missions[1].Title="Target Practice";Mission.Missions[1].Description="Destroy the non-combat drone. Enemies are marked on your radar with red blips.";Mission.Missions[1].MissionShips=[new MissionShip(new THREE.Vector3(0,50,-500))];Mission.Missions[2].Title="Combat";Mission.Missions[2].Description="Destroy the two combat drones.";Mission.Missions[2].MissionShips=[new MissionShip(new THREE.Vector3(150,150,-500)),new MissionShip(new THREE.Vector3(-150,-150,-500))];function XhtmlWingGame(a){XhtmlWingGame.MainGame=this;this._playerShip=this._skyboxMesh=this._skyboxCamera=this._skyboxScene=this._stats=this._camera=this._renderer=null;this._isStarWarsGame=!a&&"wars"===Util.GetQueryStringParameter("secret");this.isInBuildMode=!1;this.buildManager=new BuildManager;this.isTabDown=this.isInArena=!1;this.droneMesh=null;this._loadedGeometries={};this._numGeometriesToLoad=this._isStarWarsGame?3:1;this.GameIsPaused=this.IsMultiplayer=this.GameIsActive=!1;this.PrevMouseClientPos=
null;this._joypad=new Joypad;this.InvertYAxis=1;this.IsRightMouseDown=!1;this._shipExplodeSound=this._enemyHitSound=this._playerHitSound=this._laserSound=null;this._cockpitUI=new CockpitUI;this._testSphere=null;this._elapsedGameTime=0;this._portalPodMesh=null;this._portalPodDirection=new THREE.Vector3;this._portalPodTimeRemaining=0;this._ships=[];this._explosions=[];this._hoopLists=[];this._lasers=[];this._aiControllers=[];this._targetNewAreaIndex=-1;this._spaceDustSpecs=[]}
XhtmlWingGame.DustVisibleScalar=200;XhtmlWingGame.DustVisibleScalarSq=XhtmlWingGame.DustVisibleScalar*XhtmlWingGame.DustVisibleScalar;XhtmlWingGame.SpaceDustRadius=250;XhtmlWingGame.NumSpaceDustParticles=40;XhtmlWingGame.AnimationDuration=125;
XhtmlWingGame.prototype={Init:function(){this._ships=[];this._explosions=[];this._hoopLists=[];this._lasers=[];this._aiControllers=[];this._targetNewAreaIndex=-1;this._spaceDustSpecs=[];this._camera=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,1,1E4);this._skyboxCamera=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,1,1E4);window.addEventListener("resize",function(){XhtmlWingGame.MainGame.OnWindowResize()},!1);this._scene=new THREE.Scene;var a=new THREE.AmbientLight(8421504);
this._scene.add(a);this._renderer=new THREE.WebGLRenderer({canvas:document.getElementById("GameViewCanvas")});this._renderer.setSize(window.innerWidth,window.innerHeight);this._renderer.autoClear=!1;Spaceship.EngineBarTop=parseFloat(100*($("#EngineBar").position().top/$("#EngineBar").parent().height()));Spaceship.EngineBarHeight=parseFloat(100*($("#EngineBar").height()/$("#EngineBar").parent().height()));if(false)a=document.getElementById("new-gui"),this._stats.domElement.style.position=
"absolute",this._stats.domElement.style.top="0px",this._stats.domElement.style.zIndex=100,a.appendChild(this._stats.domElement);this._isStarWarsGame?this.InitShipModels_StarWars():this.InitShipModels();this._joypad&&this._joypad.Init();this._laserSound=document.getElementById(this._isStarWarsGame?"XWingLaserSound":"LaserSound");this._laserSound2=document.getElementById(this._isStarWarsGame?"XWingLaserSound2":"LaserSound2");this._playerHitSound=document.getElementById("PlayerHitSound");this._enemyHitSound=
document.getElementById("EnemyHitSound");this._shipExplodeSound=document.getElementById("ShipExplodeSound");HoopList.hoopClearedSound=document.getElementById("HoopClearedSound");this._portalPodMesh=new THREE.Mesh(new THREE.SphereGeometry(20),new THREE.MeshLambertMaterial({color:5592405,ambient:5592405,wireframe:!1}));this.InvertYAxis=Main.CurPlayerInfo.Setting_InvertY?-1:1;this._ships.push(new Spaceship(!0,this._isStarWarsGame?"XWing":"Normal"));this._playerShip=this._ships[0];this._playerShip.Speed*=
1.15;this._playerShip.TurnSpeed*=1.15;this._playerShip.RateOfFire*=0.5;this._playerShip.IsGoodGuy=!0;this._cockpitUI.InitFromDOM();this._cockpitUI.HookUpToShip(this._playerShip);a=new THREE.Mesh(new THREE.SphereGeometry(200),new THREE.MeshLambertMaterial({color:16777215}));a.position.set(45200,0,0);this._scene.add(a);a=new THREE.PointLight(16777215,2,0);a.position=new THREE.Vector3(45E3,0,0);this._scene.add(a);this.InitSpaceDust()},loadArea:function(a,b){this._areaDescriptor=AreaDescriptor.Areas[a];
var c=this;this._areaDescriptor.load(function(){c.InitSkybox(c._areaDescriptor);c.InitAsteroidFields(c._areaDescriptor);c.Render();window.localStorage.lastAreaIndex=a;b&&b()})},goToNewArea:function(a){this._targetNewAreaIndex=a},InitShipModels:function(){var a=new THREE.JSONLoader(!0);a.load("models/SFighter2.js",function(a){XhtmlWingGame.MainGame._loadedGeometries.Normal=a;a.applyMatrix((new THREE.Matrix4).makeScale(8E-4,8E-4,8E-4));XhtmlWingGame.MainGame.OnModelLoaded()},null);a.load("models/drone/quantum2.js",
function(a,c){XhtmlWingGame.DroneMaterial=c[0];XhtmlWingGame.DroneGeometry=a;a.applyMatrix((new THREE.Matrix4).makeScale(1.5,1.5,1.5))},null)},InitShipModels_StarWars:function(){var a=new THREE.JSONLoader(!0);a.load("models/VaderTie.js",function(a){XhtmlWingGame.MainGame._loadedGeometries.VadersTie=a;a.applyMatrix((new THREE.Matrix4).makeScale(20,20,20));for(var c=[],l=0;l<a.materials.length;l++)c.push(new THREE.MeshBasicMaterial({color:a.materials[l].color,wireframe:!1,side:THREE.DoubleSide}));XhtmlWingGame.MainGame.OnModelLoaded()},
null);a.load("models/Tie_Low.js",function(a){XhtmlWingGame.MainGame._loadedGeometries.Tie=a;a.applyMatrix((new THREE.Matrix4).makeScale(5,5,5));for(var c=[],l=0;l<a.materials.length;l++)c.push(new THREE.MeshBasicMaterial({color:a.materials[l].color,wireframe:!1,side:THREE.DoubleSide}));XhtmlWingGame.MainGame.OnModelLoaded()},null);a.load("models/XWing_Low.js",function(a){XhtmlWingGame.MainGame._loadedGeometries.XWing=a;a.applyMatrix((new THREE.Matrix4).makeScale(5.5,5.5,5.5));for(var c=[],l=0;l<a.materials.length;l++)c.push(new THREE.MeshBasicMaterial({color:a.materials[l].color,
wireframe:!1,side:THREE.DoubleSide}));XhtmlWingGame.MainGame.OnModelLoaded()},null)},OnModelLoaded:function(){if(Object.keys(this._loadedGeometries).length>=this._numGeometriesToLoad)for(var a=1;a<XhtmlWingGame.MainGame._ships.length;++a)XhtmlWingGame.MainGame._ships[a].UpdateFromGeometry()},InitMission:function(a){for(var b=0;b<a.MissionShips.length;++b){var c=a.MissionShips[b],l=new Spaceship(!1,c.ShipTypeName);l.Position=c.Position;l.IsGoodGuy=c.IsGoodGuy;c.IsGoodGuy||(l.Forward=new THREE.Vector3(0,
0,1));var e=new AIShipController(l);this._ships.push(l);this._aiControllers.push(e);1<a.MissionShips.length&&(e.Target=this.GetRandomShip(!c.IsGoodGuy),e.CurrentState=AIShipController.STATE_Engage)}null!=a.HoopSpline&&0<a.NumHoops&&(b=new HoopList,b.initAlongSpline(a.HoopSpline,a.NumHoops,function(){XhtmlWingGame.MainGame.EndMission(!0)}),this._cockpitUI.HoopForBlip=b.hoops[0],this._hoopLists.push(b))},GetRandomShip:function(a){for(var b=[],c=0;c<this._ships.length;++c)a===this._ships[c].IsGoodGuy&&
b.push(this._ships[c]);return 0===b.length?null:b[Math.floor(Math.random()*b.length)]},launchPortalPod:function(a){$("#PortalPanel").hide();this._portalPodMesh.position=this._playerShip.Position.clone();this._portalPodMesh.rotation=this._playerShip.GetOrientationEuler();this._scene.add(this._portalPodMesh);this._portalPodDirection=this._playerShip.Forward.clone();this._portalPodTimeRemaining=1;this._destinationAreaIndex=a},InitSpaceDust:function(){for(var a=0;a<XhtmlWingGame.NumSpaceDustParticles;++a){var b=
new THREE.MeshBasicMaterial({color:16777215,blending:THREE.NormalBlending});this._spaceDustSpecs.push(new THREE.Mesh(XhtmlWingGame.SpaceDushGeometry,b));this._spaceDustSpecs[a].position=Util.GetRandomPointInSphere(XhtmlWingGame.SpaceDustRadius);this._scene.add(this._spaceDustSpecs[a])}},InitAsteroidFields:function(a){for(var b=0;b<a.asteroidFields.length;++b)a.asteroidFields[b].init(this._scene)},InitSkybox:function(a){var b=a.skyboxImage_Prefix,a=a.skyboxImage_Extension,b=THREE.ImageUtils.loadTextureCube([b+
"right1"+a,b+"left2"+a,b+"top3"+a,b+"bottom4"+a,b+"front5"+a,b+"back6"+a]),a=THREE.ShaderLib.cube;a.uniforms.tCube.value=b;b=new THREE.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:a.uniforms,depthWrite:!1,side:THREE.BackSide});this._skyboxMesh?this._skyboxMesh.material=b:this._skyboxMesh=new THREE.Mesh(new THREE.CubeGeometry(100,100,100),b);this._skyboxScene||(this._skyboxScene=new THREE.Scene,this._skyboxScene.add(this._skyboxMesh))},OnWindowResize:function(){this._camera.aspect=
window.innerWidth/window.innerHeight;this._camera.updateProjectionMatrix();this._skyboxCamera.aspect=window.innerWidth/window.innerHeight;this._skyboxCamera.updateProjectionMatrix();this._renderer.setSize(window.innerWidth,window.innerHeight)},SceneToScreenPos:function(a){var b=new THREE.Matrix4;b.multiply(this._camera.projectionMatrix,this._camera.matrixWorldInverse);a=a.clone();a.applyMatrix4(b);return new THREE.Vector2(a.x,a.y)},handlePlayerInput:function(){if(!this.isInBuildMode){var a=!0;$(".Overlay").is(":visible")?
a=!1:Main.shouldShowLogo&&(a=!1);if(a){a=new THREE.Vector2;this._joypad&&(a=new THREE.Vector2(this._joypad.NormDirection.X,this._joypad.NormDirection.Y));0.005>a.lengthSq()&&a.set(0,0);this._playerShip.PitchYawRollSpeed.set(0,0,0);var b=!1;Main.CurPlayerInfo.Setting_ControlScheme==PlayerInfo.CONTROLSCHEME_Mouse_YawPitch?this.IsRightMouseDown&&(b=!0):this.IsRightMouseDown||(b=!0);b?this._playerShip.PitchYawRollSpeed.z=a.x:(this._playerShip.PitchYawRollSpeed.y=-a.x,this._playerShip.PitchYawRollSpeed.z=
-this._playerShip.PitchYawRollSpeed.y/1.75);this._playerShip.PitchYawRollSpeed.x=-a.y*this.InvertYAxis}else this._playerShip.PitchYawRollSpeed.set(0,0,0)}!Main.CurPlayerInfo.Setting_MouseMovesControlStick&&this._joypad&&this._joypad.Center()},Update:function(a){this._elapsedGameTime+=a;this.handlePlayerInput();0<this._portalPodTimeRemaining&&(this._portalPodTimeRemaining-=a,this._portalPodMesh.position.add(this._portalPodDirection.clone().multiplyScalar(500*a)),0>this._portalPodTimeRemaining&&(this._portal=
new Portal(this._portalPodMesh.position,this._portalPodMesh.rotation,this._portalPodDirection,this._destinationAreaIndex),this._scene.remove(this._portalPodMesh)));this._portal&&this._portal.isActive&&this._portal.update(a);for(var b=0;b<this._aiControllers.length;b++)this._aiControllers[b].Update(a);for(b=0;b<this._ships.length;b++){var c=this._ships[b];this.isInBuildMode&&c===this._playerShip?this.buildManager.update(a):c.Update(a)}for(b=0;b<this._explosions.length;++b){var l=this._explosions[b];
l.scale.add(new THREE.Vector3(a,a,a));l.material.opacity=1-l.scale.x/2;0.1>l.material.opacity&&(l.material.opacity=0,this._scene.remove(l),this._explosions.splice(b--,1))}for(var e,b=0;b<this._lasers.length;b++){e=this._lasers[b];l=!1;e.RemainingLife-=a;if(0>e.RemainingLife)l=!0;else{c=e.Direction.clone();c.multiplyScalar(a);e.Mesh.position.add(c);for(var u=new THREE.Vector3,r=0;r<this._ships.length;++r)if(c=this._ships[r],c!=e.OwningShip&&(u.subVectors(c.Position,e.Mesh.position),u.lengthSq()<c.BoundingRadiusSq)){l=
!0;c.HandleLaserHit(e);if(0>=c.HullHP){if(c==this._playerShip){this.EndMission(!1);return}this.RemoveShip(c);Main.CurPlayerInfo.Setting_PlaySounds&&this._shipExplodeSound.play();for(c=e=0;c<this._ships.length;++c)this._ships[c].IsGoodGuy||++e;if(0===e){this.EndMission(!0);return}break}Main.CurPlayerInfo.Setting_PlaySounds&&(c==this._playerShip?this._playerHitSound.play():this._enemyHitSound.play())}}l&&(this._scene.remove(this._lasers[b].Mesh),this._lasers.splice(b--,1))}for(b=0;b<this._hoopLists.length;++b)this._hoopLists[b].updatePassThrough(this._playerShip.PreviousPosition,
this._playerShip.Position);for(b=0;b<this._areaDescriptor.asteroidFields.length;++b)this._areaDescriptor.asteroidFields[b].update(a);this._cockpitUI.Update();this._playerShip.SetCameraForShip(this._camera);for(b=0;b<this._spaceDustSpecs.length;b++)a=this._spaceDustSpecs[b],l=new THREE.Vector3,l.subVectors(a.position,this._camera.position),0>l.dot(this._playerShip.Forward)&&(a.position=Util.GetRandomPointInSphere(XhtmlWingGame.SpaceDustRadius),0>this._playerShip.Forward.dot(a.position)&&(a.position=
Util.ReflectAcross(this._playerShip.Forward,a.position)),a.position.add(this._playerShip.Position),a.position.add(this._playerShip.Forward.clone().multiplyScalar(XhtmlWingGame.DustVisibleScalar))),l=this._spaceDustSpecs[b].position.clone(),l.sub(this._camera.position),l=l.lengthSq(),l=XhtmlWingGame.DustVisibleScalarSq-l,0>l&&(l=0),l/=XhtmlWingGame.DustVisibleScalarSq,a.material.opacity=l;this.Render();-1!==this._targetNewAreaIndex&&(b=this._targetNewAreaIndex,this.GameIsActive=!1,$("#loading-panel").show(),
this.Init(),this.loadArea(b,function(){var a=new THREE.Vector3(-4.414694735802865,-30.476577984154865,-520.0276006641733);XhtmlWingGame.MainGame._playerShip.Position=a;$("#loading-panel").hide();XhtmlWingGame.MainGame.GameIsActive=!0;Main.startUpdating()}))},Render:function(){this._skyboxCamera&&this._skyboxCamera.rotation.copy(this._camera.rotation);this._stats&&this._stats.update();this._renderer.render(this._skyboxScene,this._skyboxCamera);this._renderer.render(this._scene,this._camera)},RemoveShip:function(a){for(var b=
0;b<this._ships.length;++b)if(this._ships[b]==a){this._ships.splice(b,1);a.Mesh&&(a.Mesh.material.opacity=0,this._scene.remove(a.Mesh));for(b=0;b<this._aiControllers.length;++b)this._aiControllers[b].Target===a&&(this._aiControllers[b].Target=this.GetRandomShip(!this._aiControllers[b].Ship.IsGoodGuy));this._cockpitUI.OnShipRemoveFromSim(a.UniqueId);b=new THREE.MeshBasicMaterial({color:16744448,blending:THREE.NormalBlending,opacity:1});b=new THREE.Mesh(new THREE.SphereGeometry(0.75*a.BoundingRadius,
12,12),b);b.position=a.Position.clone();this._scene.add(b);this._explosions.push(b);break}},GetShipById:function(a){for(var b=0;b<this._ships.length;++b)if(this._ships[b].UniqueId===a)return this._ships[b];return null},EndMission:function(a){this.GameIsActive=!1;document.getElementById("MissionOverPanel").style.display="block";var b=document.getElementById("MissionOverResultLabel"),c=document.getElementById("MissionOverButton");document.getElementById("MissionWasSuccessField").value=a?"1":"0";a?(b.innerHTML=
"Mission Completed",c.value="Next Mission"):(b.innerHTML="Game Over",c.value="Retry Mission");c.focus()},OnTouchMove:function(a){null===this.PrevMouseClientPos&&(this.PrevMouseClientPos=new THREE.Vector2(a.X,a.Y));var b=new THREE.Vector2(a.X,a.Y),c=new THREE.Vector2;c.subVectors(b,this.PrevMouseClientPos);this._joypad&&this._joypad.ContainsClientPoint(a)?this._joypad.HandleTouchInput(a):(Main.CurPlayerInfo.Setting_MouseMovesControlStick?(Main.CurPlayerInfo.TurnRelativeToWindowCenter?(a=a.Clone(),
a.Subtract(new Vector2(window.innerWidth/2,window.innerHeight/2)),c=0.5*Math.min(window.innerWidth,window.innerHeight),a.Scale(1/c),this._joypad.NormDirection=a):(this._joypad.NormDirection.X+=0.025*c.x,this._joypad.NormDirection.Y+=0.025*c.y),1<this._joypad.NormDirection.GetLengthSq()&&this._joypad.NormDirection.Normalize()):(this._joypad.NormDirection.X=0.25*c.x,this._joypad.NormDirection.Y=0.25*c.y),this._joypad.UpdateJoypadPos());this.PrevMouseClientPos=b},OnTouchStart:function(a,b){if(this.isInBuildMode)this.buildManager.onMouseDown(a[0],
b);else!0==b?this._playerShip.IsTriggerPulled=!0:!1==b&&(this.IsRightMouseDown=!0)},OnTouchEnd:function(a){!0==a?this._playerShip.IsTriggerPulled=!1:!1==a?this.IsRightMouseDown=!1:this._joypad.Center()},OnMouseWheel:function(a){if(this.isInBuildMode)this.buildManager.onMouseWheel(a)},setBuildMode:function(a){(this.isInBuildMode=a)?(this.buildManager=new BuildManager,$("#Crosshairs").hide(),a=this._playerShip.Position.clone(),a.add(this._playerShip.Forward.clone().multiplyScalar(BuildManager.InitialBuildRadius)),
this.buildManager.centerPos=a):(this.buildManager.term(),this.buildManager=null,$("#Crosshairs").show())},OnKeyUp:function(a){if(this.isInBuildMode)this.buildManager.onKeyUp(a);else switch(a){case 9:this.isTabDown=!1,this.isInArena&&$("#arena-player-list").hide()}},OnKeyDown:function(a){if(this.isInBuildMode)this.buildManager.onKeyDown(a);else switch(a){case 27:this.EndMission(!1);break;case 9:this.isTabDown=!0;this.isInArena&&$("#arena-player-list").show();break;case 69:case 76:case 83:this._playerShip.AdjustEngineOutput(String.fromCharCode(a));
break;case 84:this._playerShip.AdjustThrottle();break;case 70:case 82:case 77:this._playerShip.AdjustShield(String.fromCharCode(a));break;case 80:$("#PortalPanel").toggle();break;case 66:this.setBuildMode(!0);break;case 78:$("#Container").toggle();break;case 67:null!=this.droneMesh&&this._scene.remove(this.droneMesh),this.droneMesh=new THREE.Mesh(XhtmlWingGame.DroneGeometry,XhtmlWingGame.DroneMaterial),this.droneMesh.position=this._playerShip.Position.clone(),this.droneMesh.position.add(this._playerShip.Forward.clone().multiplyScalar(40)),
this.droneMesh.rotation=this._playerShip.GetOrientationEuler(),this._scene.add(this.droneMesh)}},Term:function(){this._cockpitUI.Term()}};XhtmlWingGame.SpaceDushGeometry=new THREE.SphereGeometry(0.375,5,5);function PlayerInfo(){this.MaxCompletedMissionNumber=-1;this.NumDronesForSkirmish=3;this.HasAchievedNoviceBadge=!1;this.TurnRelativeToWindowCenter=!0;this.Setting_ControlScheme=PlayerInfo.CONTROLSCHEME_Mouse_YawPitch;this.Setting_MouseMovesControlStick=!0;this.Setting_InvertY=!1;this.Setting_PlaySounds=!0}PlayerInfo.CONTROLSCHEME_Mouse_YawPitch=0;PlayerInfo.CONTROLSCHEME_Mouse_RollPitch=1;PlayerInfo.LocalStorageItemPrefix="PlayerInfo_";
PlayerInfo.prototype={SaveToLocalStorage:function(){for(var a in this)this.hasOwnProperty(a)&&(window.localStorage[PlayerInfo.LocalStorageItemPrefix+a]=this[a].toString())},LoadFromLocalStorage:function(){for(var a in this)if(this.hasOwnProperty(a)){var b=window.localStorage[PlayerInfo.LocalStorageItemPrefix+a];null!=b&&("number"==typeof this[a]?this[a]=parseInt(b):"string"==typeof this[a]?this[a]=b:"boolean"==typeof this[a]&&(this[a]="true"==b))}}};var Main={_gameMgrObj:null,_prevFrameTime:(new Date).getTime(),_missionIndex:0,animFrameId:null,CurPlayerInfo:new PlayerInfo,OnLoad:function(){Main.CurPlayerInfo.LoadFromLocalStorage();Main._missionIndex=Main.CurPlayerInfo.MaxCompletedMissionNumber+1;Main.PopulateMissionsList();document.oncontextmenu=function(){return!1};PageInput.Init(Main);Main.InitMission();$(".galaxy-button").click(function(){var a=this.id,a=a.substring(10),a=parseInt(a);Main._gameMgrObj.launchPortalPod(a)});$(".portal-menu-button").click(function(){$(".portal-menu-button").removeClass("selected");
$(this).addClass("selected")});setInterval(function(){for(var a=[60,43,78,94,53],b=0;b<a.length;++b){var c=Math.floor(16*Math.random())-8,c=c+a[b];$("#ping-"+b).text(c)}},1E3);Main.shouldShowLogo="1"===Util.GetQueryStringParameter("logo");Main.shouldShowLogo&&($("#Logo").show(),$("#new-gui").hide(),$("#SettingsButton").hide())},Update:function(){var a=(new Date).getTime(),b=(a-Main._prevFrameTime)/1E3;Main._prevFrameTime=a;0.125<b&&(b=0.125);Main._gameMgrObj.Update(b);Main.animFrameId=null;!Main._gameMgrObj.GameIsPaused&&
Main._gameMgrObj.GameIsActive&&Main.startUpdating()},OnStartMissionClick:function(){document.getElementById("MissionInfoPanel").style.display="none";Main._gameMgrObj._joypad.Center();Main._gameMgrObj.GameIsActive=!0;Main.startUpdating()},OnNextMissionClick:function(){document.getElementById("MissionOverPanel").style.display="none";var a="1"===document.getElementById("MissionWasSuccessField").value;a&&(Main._missionIndex<Mission.Missions.length?(Main._missionIndex>Main.CurPlayerInfo.MaxCompletedMissionNumber&&
(Main.CurPlayerInfo.MaxCompletedMissionNumber=Main._missionIndex),++Main._missionIndex):++Main.CurPlayerInfo.NumDronesForSkirmish,Main.PopulateMissionsList(),Main.CurPlayerInfo.SaveToLocalStorage());Main.InitMission(a)},InitMission:function(a){Main._gameMgrObj&&Main._gameMgrObj.Term();Main._gameMgrObj=new XhtmlWingGame(a);Main._gameMgrObj.Init();Main._gameMgrObj.loadArea(0);var a=document.getElementById("MissionTitleLabel"),b=document.getElementById("MissionDescLabel"),c;XhtmlWingGame.MainGame._isStarWarsGame?
(c=Mission.MakeStarWars(),a.style.fontSize="36px"):c=Main._missionIndex<Mission.Missions.length?Mission.Missions[Main._missionIndex]:Mission.MakeSkirmish(Main.CurPlayerInfo.NumDronesForSkirmish);a.innerHTML=c.Title;b.innerHTML=c.Description;Main._gameMgrObj.InitMission(c);document.getElementById("MissionInfoPanel").style.display="block"},OnKeyUp:function(a){Main._gameMgrObj.OnKeyUp(a)},OnKeyDown:function(a){Main._gameMgrObj.OnKeyDown(a)},OnMouseWheel:function(a){Main._gameMgrObj.OnMouseWheel(a)},
OnTouchStart:function(a,b){Main._gameMgrObj.OnTouchStart(a,b)},OnTouchEnd:function(a){Main._gameMgrObj.OnTouchEnd(a)},OnTouchMove:function(a){Main._gameMgrObj.OnTouchMove(a[0])},OnSettingsClicked:function(){document.getElementById("Setting_InvertYAxis").checked=Main.CurPlayerInfo.Setting_InvertY;document.getElementById("Setting_PlaySounds").checked=Main.CurPlayerInfo.Setting_PlaySounds;Main.CurPlayerInfo.Setting_ControlScheme==PlayerInfo.CONTROLSCHEME_Mouse_YawPitch?document.getElementById("Setting_Control_PitchBank").checked=
!0:document.getElementById("Setting_Control_PitchRoll").checked=!0;Main.CurPlayerInfo.Setting_MouseMovesControlStick?document.getElementById("Setting_Control_MoveControlStick").checked=!0:document.getElementById("Setting_Control_MoveShip").checked=!0;document.getElementById("Setting_TurnRelativeToWindowCenter").checked=Main.CurPlayerInfo.TurnRelativeToWindowCenter;$("#SettingsPanel").fadeIn(3*XhtmlWingGame.AnimationDuration);!Main._gameMgrObj.IsMultiplayer&&Main._gameMgrObj.GameIsActive&&(Main._gameMgrObj.GameIsPaused=
!0)},OnSettingsClosed:function(){Main.CurPlayerInfo.Setting_InvertY=!1!=document.getElementById("Setting_InvertYAxis").checked;Main._gameMgrObj.InvertYAxis=Main.CurPlayerInfo.Setting_InvertY?-1:1;Main.CurPlayerInfo.Setting_PlaySounds=!1!=document.getElementById("Setting_PlaySounds").checked;Main.CurPlayerInfo.Setting_ControlScheme=!1!=document.getElementById("Setting_Control_PitchBank").checked?PlayerInfo.CONTROLSCHEME_Mouse_YawPitch:PlayerInfo.CONTROLSCHEME_Mouse_RollPitch;Main.CurPlayerInfo.Setting_MouseMovesControlStick=
!1!=document.getElementById("Setting_Control_MoveControlStick").checked;Main.CurPlayerInfo.TurnRelativeToWindowCenter=!1!=document.getElementById("Setting_TurnRelativeToWindowCenter").checked;Main.CurPlayerInfo.SaveToLocalStorage();$("#SettingsPanel").fadeOut(3*XhtmlWingGame.AnimationDuration);!Main._gameMgrObj.IsMultiplayer&&Main._gameMgrObj.GameIsActive&&(Main._prevFrameTime=(new Date).getTime(),Main._gameMgrObj.GameIsPaused=!1,Main.Update())},OnMissionClick:function(a){Main._missionIndex=a;Main.InitMission(!0)},
onMMOClick:function(){Main._gameMgrObj&&Main._gameMgrObj.Term();var a=window.localStorage.lastAreaIndex;a||(a=0);Main._gameMgrObj=new XhtmlWingGame;Main._gameMgrObj.Init();Main._gameMgrObj.loadArea(a,function(){$("#MissionInfoPanel").hide();Main._gameMgrObj.GameIsActive=!0;Main.startUpdating()})},startUpdating:function(){null===Main.animFrameId&&(Main.animFrameId=requestAnimationFrame(Main.Update))},onArenaClick:function(){Main._gameMgrObj&&Main._gameMgrObj.Term();Main._gameMgrObj=new XhtmlWingGame;
Main._gameMgrObj.Init();Main._gameMgrObj.loadArea(0,function(){$("#MissionInfoPanel").hide();Main._gameMgrObj.InitMission(Mission.MakeArena());Main._gameMgrObj.GameIsActive=!0;Main._gameMgrObj.isInArena=!0;Main.startUpdating()})},PopulateMissionsList:function(){var a=document.getElementById("CurrentMissionsRow");Util.RemoveAllChildren(a);for(var b=0;b<Mission.Missions.length;++b){var c=Mission.Missions[b],l=b-1<=Main.CurPlayerInfo.MaxCompletedMissionNumber?"<div class='SimpleBordered button' onclick='Main.OnMissionClick("+
b+");' style='cursor:pointer;'>":"<div class='SimpleBordered'>",e="<span style='text-decoration:underline;'>Mission "+(b+1)+"</span>",u=b<=Main.CurPlayerInfo.MaxCompletedMissionNumber?"<span style='color:#4F4;'>Complete</span>":"<span style='color:#F44;'>Incomplete</span>",r=document.createElement("td");r.innerHTML=l+e+"<br />"+c.Title+"<br />"+u+"</div>";a.appendChild(r)}l=(u=Main.CurPlayerInfo.MaxCompletedMissionNumber>=Mission.Missions.length-1)?"<div class='SimpleBordered button' onclick='Main.OnMissionClick("+
Mission.Missions.length+");'>":"<div class='SimpleBordered'>";e="<span style='text-decoration:underline;'>Skirmish</span>";u=u?"<span style='color:#4F4;'>Available</span>":"<span style='color:#F44;'>Locked</span>";b=document.createElement("td");b.innerHTML=l+e+"<br />"+c.Title+"<br />"+u+"</div>";a.appendChild(b)}};var TestPAD;
(function(a){var b=function(a,b){this.X=a||0;this.Y=b||0};b.prototype.toString=function(){return"("+this.X+","+this.Y+")"};b.prototype.Clone=function(){return new b(this.X,this.Y)};b.prototype.Set=function(a,b){this.X=a;this.Y=b};a.Vector2=b;var c=function(a,c){this.TopLeft=new b;this.Size=new b;this.TopLeft=a||new b;this.Size=c||new b};c.prototype.Right=function(){return this.TopLeft.X+this.Size.X};c.prototype.Bottom=function(){return this.TopLeft.Y+this.Size.Y};c.prototype.Contains=function(a){return a.X>=
this.TopLeft.X&&a.Y>=this.TopLeft.Y&&a.X<this.Right()&&a.Y<this.Bottom()};a.Rect2=c;var l=function(){};l.Init=function(){$(window).resize(l.OnResize);l.OnResize()};l.OnResize=function(){var a=new b($(window).width(),$(window).height()),c=1*a.Y;c>a.X?($("#Container").width(a.X),$("#Container").height(a.X/1)):($("#Container").width(c),$("#Container").height("100%"));$("#Container").css("left",Math.floor((a.X-c)/2)+"px")};a.PortraitResize=l;var e=function(a){"string"===typeof a&&0<a.length&&this.Load(a)};
e.prototype.Load=function(a,b,c){var e=this;setTimeout(function(){e.Load_Internal(a,b,c)},750)};e.prototype.Load_Internal=function(a,b,c){null===e.s_IsPhoneGap&&(e.s_IsPhoneGap=!0,-1!=navigator.userAgent.toLowerCase().indexOf("android")&&(e.s_AudioPath="/android_asset/www/"+e.s_AudioPath));var m=this,p=function(){console.info("Loaded "+a);!0===b&&m.Play()},q=function(){e.s_IsPhoneGap||(m._mediaObject.currentTime=0);m.Play()};try{e.s_IsPhoneGap?(this._mediaObject=new Media(e.s_AudioPath+a,null,null),
b&&this.Play()):(this._mediaObject=new Audio,this._mediaObject.src=e.s_AudioPath+a,this._mediaObject.addEventListener("loadeddata",p,!0),c&&this._mediaObject.addEventListener("ended",q,!1))}catch(l){this._mediaObject=null}};e.prototype.Play=function(){this._mediaObject&&this._mediaObject.play()};e.prototype.Stop=function(){this._mediaObject&&(e.s_IsPhoneGap?this._mediaObject.stop():this._mediaObject.pause())};e.s_IsPhoneGap=null;e.s_AudioPath="audio/";a.AudioInstance=e;c=function(){};c.MakeStringFitInParent=
function(a){var a=document.getElementById(a),b=a.parentElement,c=b.offsetHeight,e=b.clientWidth,p=b.clientHeight;window.getComputedStyle&&(e-=parseInt(window.getComputedStyle(b,null).getPropertyValue("padding-left")),e-=parseInt(window.getComputedStyle(b,null).getPropertyValue("padding-right")),p-=parseInt(window.getComputedStyle(b,null).getPropertyValue("padding-top")),p-=parseInt(window.getComputedStyle(b,null).getPropertyValue("padding-bottom")));var p=0.9*p,b=Math.floor(c),b=b+b%2,c=0,q=b;for(a.style.fontSize=
b+"px";3<q-c;)a.offsetWidth>e||a.offsetHeight>p?(q=b,b=Math.floor((q+c)/2)):(c=b,b=Math.floor((q+b)/2)),a.style.fontSize=b+"px";a.style.fontSize=c+"px"};a.HtmlHelper=c})(TestPAD||(TestPAD={}));(function(a){var b=function(){};b.NumTilesHorizontal=6;b.NumTilesVertical=6;b.AnimationDuration=250;b.NumClearsToRaiseFlag=5;a.GameConfig=b})(TestPAD||(TestPAD={}));(function(a){var b=a.FluxState||(a.FluxState={});b[b.None=0]="None";b[b.RemovingMatches=1]="RemovingMatches";b[b.FillingGaps=2]="FillingGaps";var c=a.FluxState,l;l=function(){};a.GameBoardTileType=l;var e=function(){this.GridPos=new a.Vector2};e.prototype.SetType=function(a){this.Type=a.Id;0==this.DomElement.children().length&&this.DomElement.append("<div class='GameBoardTileContent'></div>");this.DomElement.children().css("background-image","url("+a.ImagePath+")")};e.prototype.GetTileSlot=function(){return $("#"+
(r.GameBoardTileSlotPrefix+this.GridPos.Y+"_"+this.GridPos.X))};a.GameBoardTile=e;var u;u=function(a,b,c){this.ComboDepth=0;this.Size=a;this.Type=b;this.ComboDepth=c};a.TileMatch=u;var r,n=function(){this._tiles=[];this._allTileTypes=[];this._nextTileId=1;this._draggingTile=null;this._fluxState=c.None;this._numTilesOnBoard=this._numBlockClearAnimations=0;this._clearedMatches=[];this._owningGame=null};n.prototype.RegisterTileType=function(a,b){var c=new l;c.Id=a;c.ImagePath=b;this._allTileTypes.push(c)};
n.prototype.Init=function(b,c){n.Instance=this;this._boardElem=$("#"+b);this._owningGame=c;for(var e="",l=Math.floor(100/a.GameConfig.NumTilesHorizontal),r=l.toString()+"%",u=Math.floor(100/a.GameConfig.NumTilesVertical),ca=u.toString()+"%",y=0;y<a.GameConfig.NumTilesVertical;++y)for(var H="top:"+((u*y).toString()+"%")+"; width:"+r+"; height:"+ca,aa=0;aa<a.GameConfig.NumTilesHorizontal;++aa)var I=(l*aa).toString()+"%",e=e+("<div id='"+n.GameBoardTileSlotPrefix+y+"_"+aa+"' style='position:absolute;"),
e=e+H,e=e+"; left: ",e=e+I,e=e+"'></div>";$("#"+b).html(e);this._boardTiles=Array(a.GameConfig.NumTilesVertical);for(y=0;y<a.GameConfig.NumTilesVertical;++y){this._boardTiles[y]=[];for(e=0;e<a.GameConfig.NumTilesHorizontal;++e)this.AddNewTile(y,e)}};n.OnTileDragStart=function(a){if(n.Instance._fluxState!=c.None)return!1;a=n.Instance.GetTileFromDomElem(a.target);if(!a)return!1;n.Instance._draggingTile=a;a.DomElement.css("opacity","0.5")};n.OnTileDragging=function(b,c){var e=b.target,l=n.Instance._draggingTile;
if(l){var r=new a.Vector2;r.X=c.offset.left+e.offsetWidth/2;r.Y=c.offset.top+e.offsetHeight/2;e=n.Instance.GetTileFromOffsetPos(r.X,r.Y);null!==e&&e.Id!==l.Id&&n.Instance.SwapTiles(l,e)}};n.OnTileDragStop=function(){n.Instance._draggingTile.DomElement.css("opacity","1.0");var a=n.Instance._draggingTile;n.Instance._draggingTile=null;n.Instance.OnTilesSettled(a)};n.prototype.GetGridPosFromOffsetPos=function(b,c){var e=new a.Vector2(this._boardElem.width()/a.GameConfig.NumTilesHorizontal,this._boardElem.height()/
a.GameConfig.NumTilesVertical),b=b-this._boardElem.offset().left,c=c-this._boardElem.offset().top,e=new a.Vector2(Math.floor(b/e.X),Math.floor(c/e.Y));return 0>e.X||e.X>=a.GameConfig.NumTilesHorizontal||0>e.Y||e.Y>=a.GameConfig.NumTilesVertical?null:e};n.prototype.GetTileFromOffsetPos=function(a,b){var c=this.GetGridPosFromOffsetPos(a,b);return!c?null:this._boardTiles[c.Y][c.X]};n.prototype.GetTileAtGridPos=function(a,b){return this._boardTiles[a][b]};n.prototype.GetTileAtGridPos2=function(a){return this._boardTiles[a.Y][a.X]};
n.prototype.GetTileSlotOffsetRect=function(b){var c=new a.Rect2,b=$("#"+n.GameBoardTileSlotPrefix+b.Y+"_"+b.X);c.TopLeft.X=b.offset().left;c.TopLeft.Y=b.offset().top;c.Size.X=b.width();c.Size.Y=b.height();return c};n.prototype.GetTileFromDomElem=function(a){if(-1==a.id.indexOf(n.GameBoardTilePrefix))return null;a=parseInt(a.id.substring(n.GameBoardTilePrefix.length));return n.Instance._tiles[a]};n.prototype.SwapTiles=function(a,b){var c=a.GetTileSlot(),e=b.GetTileSlot();a.DomElement.detach();e.append(a.DomElement);
b.DomElement.detach();c.append(b.DomElement);this._boardTiles[a.GridPos.Y][a.GridPos.X]=b;this._boardTiles[b.GridPos.Y][b.GridPos.X]=a;c=a.GridPos.Clone();a.GridPos=b.GridPos;b.GridPos=c};n.prototype.OnTilesSettled=function(b){this._fluxState=c.RemovingMatches;b&&this.CheckForMatchFromSpecificGridPos(b);for(b=0;b<a.GameConfig.NumTilesVertical;++b)for(var e=0;e<a.GameConfig.NumTilesHorizontal;++e){var l=this._boardTiles[b][e];l&&this.CheckForMatchFromSpecificGridPos(l)}this._numTilesOnBoard===a.GameConfig.NumTilesHorizontal*
a.GameConfig.NumTilesVertical&&(this._owningGame&&this._owningGame.OnPlayerMoveEnd&&this._owningGame.OnPlayerMoveEnd(this._clearedMatches),this._fluxState=c.None,this._clearedMatches=[])};n.prototype.CheckForMatchFromSpecificGridPos=function(a){a=this.FindMatchFromSpecificGridPos(a);null!==a&&this.RemoveTileMatchBlock(a)};n.prototype.FindMatchFromSpecificGridPos=function(b){for(var c=[],e=b.GridPos.X-1;0<=e;){var l=this.GetTileAtGridPos(b.GridPos.Y,e);if(null===l||l.Type!==b.Type)break;c.push(l);
this._boardTiles[b.GridPos.Y][e]=null;--e}for(e=b.GridPos.X+1;e<a.GameConfig.NumTilesHorizontal;){l=this.GetTileAtGridPos(b.GridPos.Y,e);if(null===l||l.Type!==b.Type)break;c.push(l);this._boardTiles[b.GridPos.Y][e]=null;++e}if(2>c.length){for(l=0;l<c.length;++l)this._boardTiles[c[l].GridPos.Y][c[l].GridPos.X]=c[l];c=[]}for(var e=[],n=b.GridPos.Y-1;0<=n;){l=this.GetTileAtGridPos(n,b.GridPos.X);if(null===l||l.Type!==b.Type)break;e.push(l);this._boardTiles[n][b.GridPos.X]=null;--n}for(n=b.GridPos.Y+
1;n<a.GameConfig.NumTilesVertical;){l=this.GetTileAtGridPos(n,b.GridPos.X);if(null===l||l.Type!==b.Type)break;e.push(l);this._boardTiles[n][b.GridPos.X]=null;++n}if(2>e.length){for(l=0;l<e.length;++l)this._boardTiles[e[l].GridPos.Y][e[l].GridPos.X]=e[l];e=[]}return 2<=c.length||2<=e.length?(c=c.concat(e),c.push(b),this._boardTiles[b.GridPos.Y][b.GridPos.X]=null,c):null};n.OnAnimationEnded=function(){var a=n.Instance;--a._numBlockClearAnimations;0>=a._numBlockClearAnimations&&(a._numBlockClearAnimations=
0,a._fluxState===c.RemovingMatches?(a._fluxState=c.FillingGaps,a.FillGaps()):a._fluxState===c.FillingGaps&&a.OnTilesSettled())};n.prototype.FillGaps=function(){for(var b=0;b<a.GameConfig.NumTilesHorizontal;++b){for(var c=0,e=a.GameConfig.NumTilesVertical-1;0<=e;--e){var l=this._boardTiles[e][b];null===l?++c:this.SendBlockDown(l,c)}this.AddBlocksToColumn(b,c)}};n.prototype.AddNewTile=function(a,b){var c=new e;c.Id=++this._nextTileId;c.GridPos.Y=a;c.GridPos.X=b;this._tiles[c.Id]=c;$("#"+n.GameBoardTileSlotPrefix+
a+"_"+b).append("<div id='"+n.GameBoardTilePrefix+c.Id+"' class='GameBoardTile'></div>");c.DomElement=$("#"+n.GameBoardTilePrefix+c.Id);c.SetType(this.GetRandomTileType());this._boardTiles[a][b]=c;c.DomElement.draggable({distance:5,helper:"clone",start:n.OnTileDragStart,stop:n.OnTileDragStop,drag:n.OnTileDragging,zIndex:20});++this._numTilesOnBoard;$("#NumTilesLabel").text(this._numTilesOnBoard.toString());return c};n.prototype.AddBlocksToColumn=function(b,c){for(var e=0;e<c;++e){var l=this.AddNewTile(e,
b),r=l.DomElement.height()*c;l.DomElement.css("top",(-r).toString()+"px");l.DomElement.animate({top:"0px"},a.GameConfig.AnimationDuration,n.OnAnimationEnded);++this._numBlockClearAnimations}};n.prototype.SendBlockDown=function(b,c){this._boardTiles[b.GridPos.Y][b.GridPos.X]=null;b.GridPos.Y+=c;this._boardTiles[b.GridPos.Y][b.GridPos.X]=b;b.DomElement.detach();b.GetTileSlot().append(b.DomElement);var e=b.DomElement.height()*c;b.DomElement.css("top",(-e).toString()+"px");b.DomElement.animate({top:"0px"},
a.GameConfig.AnimationDuration,n.OnAnimationEnded);++this._numBlockClearAnimations};n.prototype.RemoveTileMatchBlock=function(b){this._clearedMatches.push(new u(b.length,b[0].Type,this._clearedMatches.length));new a.Vector2(b[0].DomElement.offset().left-$("#Container").offset().left,b[0].DomElement.offset().top-$("#Container").offset().top);for(var c=function(){$(this).remove();n.OnAnimationEnded()},e=0;e<b.length;++e){var l=b[e];++this._numBlockClearAnimations;l.DomElement.fadeOut(500,c);this._boardTiles[l.GridPos.Y][l.GridPos.X]=
null;this._tiles[l.Id]=null;l.Id=-1;l.GridPos.Set(-1,-1);--this._numTilesOnBoard;$("#NumTilesLabel").text(this._numTilesOnBoard.toString())}};n.prototype.GetRandomTileType=function(){var a=Math.floor(Math.random()*this._allTileTypes.length);return this._allTileTypes[a]};n.prototype.FillWithRandom=function(){for(var b=0;b<a.GameConfig.NumTilesVertical;++b)for(var c=0;c<a.GameConfig.NumTilesHorizontal;++c)this._boardTiles[b][c].SetType(this.GetRandomTileType())};n.GameBoardTilePrefix="GameBoardTile_";
n.GameBoardTileSlotPrefix="GameBoardTileSlot_";r=n;a.GameBoard=r})(TestPAD||(TestPAD={}));
